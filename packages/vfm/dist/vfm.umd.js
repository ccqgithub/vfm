(function(d,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(d=typeof globalThis!="undefined"?globalThis:d||self,r(d.VFM={},d.Vue))})(this,function(d,r){"use strict";var dt=Object.defineProperty,ht=Object.defineProperties;var ft=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var G=(d,r,b)=>r in d?dt(d,r,{enumerable:!0,configurable:!0,writable:!0,value:b}):d[r]=b,D=(d,r)=>{for(var b in r||(r={}))H.call(r,b)&&G(d,b,r[b]);if(M)for(var b of M(r))J.call(r,b)&&G(d,b,r[b]);return d},U=(d,r)=>ht(d,ft(r));var q=(d,r)=>{var b={};for(var A in d)H.call(d,A)&&r.indexOf(A)<0&&(b[A]=d[A]);if(d!=null&&M)for(var A of M(d))r.indexOf(A)<0&&J.call(d,A)&&(b[A]=d[A]);return b};const b=e=>{const t="{{name}} is not alphabetical";return typeof e!="string"?t:/^[a-zA-Z]*$/.test(e)?"":t},A=e=>{const t="{{name}} must be alpha-numeric";return typeof e!="string"&&typeof e!="number"?t:/^[a-zA-Z0-9]*$/.test(`${e}`)?"":t},Q=e=>{const t="{{name}} must be decimal";return typeof e!="string"&&typeof e!="number"?t:/^[-]?\d*(\.\d+)?$/.test(`${e}`)?"":t},X=/^(?:[A-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]{2,}(?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i,Y=e=>{const t="{{name}} is not a valid email address";return typeof e!="string"?t:X.test(e)?"":t},tt=e=>{const t="{{name}} is not an integer";return typeof e!="string"&&typeof e!="number"?t:/(^[0-9]*$)|(^-[0-9]+$)/.test(`${e}`)?"":t},et=e=>{const t="{{name}} is not a valid IP address";if(typeof e!="string")return t;const s=e.split(".");return s.length===4&&s.every(st)?"":t},st=e=>{if(e.length>3||e.length===0||e[0]==="0"&&e!=="0"||!e.match(/^\d+$/))return!1;const t=+e;return t>=0&&t<=255},it=e=>{const t="{{name}} is not a valid MAC Address";if(typeof e!="string")return t;const s=":",i=e.split(s);return(i.length===6||i.length===8)&&i.every(rt)?"":t},rt=e=>e.toLowerCase().match(/^[0-9a-f]{2}$/),k={alpha:b,alphaNum:A,decimal:Q,email:Y,integer:tt,ipAddress:et,macAddress:it,numeric:e=>{const t="{{name}} must be numeric";return typeof e!="string"&&typeof e!="number"?t:/^-?\d*(\.\d+)?$/.test(`${e}`)?"":t}},C=(e,t,s)=>{const i=t.split(".");let a=e;for(;i.length&&typeof a=="object"&&a!==null;){const n=i.shift();i.length===0?a[n]=s:(typeof a[n]!="object"||a[n]===null)&&(a[n]=/^\d+$/.test(n)?[]:{}),a=a[n]}},F=(e,t)=>{const s=t.split(".");let i=e;for(;s.length&&i;){const a=s.shift();i=typeof i=="object"&&i!==null?i[a]:void 0}return i},$=(e,t)=>{const s=t.split(".");let i=e;for(;s.length&&typeof i=="object"&&i!==null;){const a=s.shift();s.length===0?Array.isArray(i)?/^\d+$/.test(a)&&i.splice(Number(a),1):delete i[a]:i=i[a]}},R=(e,t,s=!0)=>{const i=Object.keys(e),a=Object.keys(t),n=i.filter(l=>!a.includes(l));s&&n.forEach(l=>{delete e[l]}),a.forEach(l=>{typeof e[l]=="object"&&!Array.isArray(e[l])&&e[l]!==null&&typeof t[l]=="object"&&!Array.isArray(t[l])&&t[l]!==null?R(e[l],t[l],s):e[l]=t[l]})},W=e=>{const t=[];let s=null;const i=e(n=>{t.push(n)}),a=new Promise((n,l)=>{s=n,i.then(n,l)});return a.cancel=()=>{s==null||s(""),t.forEach(n=>n())},a},P=[String,Number,Boolean,Symbol,Array,Object],at=(e,t,s,i)=>W(async a=>{if(e.required&&!t&&t!==0||e.requiredLength&&(typeof(t==null?void 0:t.length)!="number"||t.length<=0))return"{{name}} is required";if(e.minLength!==void 0&&(typeof(t==null?void 0:t.length)!="number"||t.length<e.minLength))return`{{name}}'s length cannot be less than ${e.minLength}`;if(e.maxLength!==void 0&&(typeof(t==null?void 0:t.length)!="number"||t.length>e.maxLength))return`{{name}}'s length cannot be greater than ${e.maxLength}`;if(e.min!==void 0&&(typeof t!="number"||t<e.min))return`{{name}} cannot be less than ${e.min}`;if(e.max!==void 0&&(typeof t!="number"||t>e.max))return`{{name}} cannot be greater than ${e.max}`;if(e.pattern&&(typeof t!="string"&&typeof t!="number"||!e.pattern.test(`${t}`)))return`{{name}} not match ${e.pattern.toString()}`;for(const n of Object.keys(k))if(e[n]===!0){const c=k[n](t,s,i);typeof c=="object"&&typeof c.cancel=="function"&&a(()=>{var p;return(p=c.cancel)==null?void 0:p.call(c)});const m=await c;if(m)return m}if(e.validator){const n=e.validator(t,s,i);typeof n=="object"&&typeof n.cancel=="function"&&a(()=>{var c;return(c=n.cancel)==null?void 0:c.call(n)});const l=await n;if(l)return l}return""});class z{constructor(t,s){this.rules=r.ref([]),this.validateCount=0,this.transform=null,this.isEqual=null,this.focusFn=null,this.stopValidateWatcher=null,this.stopDirtyWatcher=null,this.isRegistered=!1,this.isInited=!1,this.runInAction=n=>{n()};const{immediate:i=!0}=s;this.form=t,this.name=s.name,this.rules.value=s.rules||[],this.transform=s.transform||null,this.isEqual=s.isEqual||null,this.focusFn=s.onFocus||null,this.state=r.reactive({error:null,isError:!1,isValidating:!1,isDirty:!1,isTouched:!1,isChanged:!1});const a=()=>{const n=r.toRaw(this.state),l=this.value,c={isValidating:n.isValidating,isDirty:this.state.isDirty,isTouched:this.state.isTouched,isChanged:this.state.isChanged},m=this.form.state,p=this.transform,y=this.rules.value;return W(async _=>{for(const V of y){const w=at(V,p&&l!==void 0?p(l):l,c,m);_(()=>{var v;return(v=w.cancel)==null?void 0:v.call(w)});const E=await w;let S=null;if(E)return S=typeof E=="string"?{type:V.type,message:E}:E,S.message=S.message.replace(/\{\{name\}\}/g,this.name),V.message!==void 0&&(S.message=V.message.replace(/\{\{name\}\}/g,this.name)),S}return null})};this.validate=a,i&&this.onRegister()}get value(){return F(this.form.state.values,this.name)}get defaultValue(){return F(this.form.state.defaultValues,this.name)}update(t={}){t.rules&&(this.rules.value=t.rules)}initWatcher(){this.isInited||(this.stopValidateWatcher=r.watchEffect(async t=>{this.validateCount++;const s=this.validateCount,i=this.validate;this.runInAction(()=>{this.state.isValidating=!0});const a=i();t(()=>{var l;return(l=a.cancel)==null?void 0:l.call(a)});const n=await a;s===this.validateCount&&this.runInAction(()=>{this.state.isValidating=!1;const l=!!(n!=null&&n.message);l?(this.state.error||(this.state.error={message:""}),this.state.error.message=(n==null?void 0:n.message)||"",this.state.error.type=n==null?void 0:n.type):this.state.error=null,this.state.isError=l})}),this.isInited=!0)}onRegister(){this.isRegistered||(this.initWatcher(),this.isRegistered=!0)}onUnregister(){var t,s;(t=this.stopValidateWatcher)==null||t.call(this),(s=this.stopDirtyWatcher)==null||s.call(this),this.isRegistered=!1,this.isInited=!1}onTouched(t=!0){this.runInAction(()=>{this.state.isTouched=t})}onChanged(t=!0){this.state.isChanged=t}onFocus(){var t;(t=this.focusFn)==null||t.call(this)}reset(t={}){var s,i;this.validateCount++,(s=this.stopValidateWatcher)==null||s.call(this),(i=this.stopDirtyWatcher)==null||i.call(this),this.runInAction(()=>{const{keepChanged:a=!1,keepTouched:n=!1}=t;this.state.error=null,this.state.isError=!1,this.state.isValidating=!1,this.state.isDirty=!1,this.state.isTouched=n?this.state.isTouched:!1,this.state.isChanged=a?this.state.isChanged:!1}),this.isInited=!1,this.initWatcher()}}const nt=(e,t)=>W(async s=>{if(e.validator){const i=e.validator(t);typeof i=="object"&&typeof i.cancel=="function"&&s(()=>{var n;return(n=i.cancel)==null?void 0:n.call(i)});const a=await i;if(a)return a}return""});class j{constructor(t,s){this.name="",this.rules=r.ref([]),this.validateCount=0,this.stopValidateWatcher=null,this.isRegistered=!1,this.isInited=!1,this.runInAction=n=>{n()};const{immediate:i=!0}=s;this.form=t,this.name=s.name,this.rules.value=s.rules||[],this.state=r.reactive({name:this.name,error:null,isError:!1,isValidating:!1});const a=()=>{const n=this.form.state,l=this.rules.value;return console.log("validate"),W(async c=>{let m=null;for(const p of l){const y=nt(p,n);c(()=>{var V;return(V=y.cancel)==null?void 0:V.call(y)});const _=await y;if(_)return m=typeof _=="string"?{type:p.type,message:_}:_,m.message=m.message.replace(/\{\{name\}\}/g,this.name),p.message!==void 0&&(m.message=p.message.replace(/\{\{name\}\}/g,this.name)),m}return null})};this.validate=a,i&&this.initWatcher()}update(t){t.rules&&(this.rules.value=t.rules)}initWatcher(){this.isInited||(this.stopValidateWatcher=r.watchEffect(async t=>{this.validateCount++;const s=this.validateCount;this.runInAction(()=>{this.state.isValidating=!0});const i=this.validate();t(()=>{var n;return(n=i.cancel)==null?void 0:n.call(i)});const a=await i;s===this.validateCount&&this.runInAction(()=>{this.state.isValidating=!1;const n=!!(a!=null&&a.message);n?(this.state.error||(this.state.error={message:""}),this.state.error.message=(a==null?void 0:a.message)||"",this.state.error.type=a==null?void 0:a.type):this.state.error=null,this.state.isError=n})}),this.isInited=!0)}onRegister(){this.isRegistered||(this.initWatcher(),this.isRegistered=!0)}onUnregister(){var t;(t=this.stopValidateWatcher)==null||t.call(this),this.isRegistered=!1,this.isInited=!1}}class O{constructor(t){this.touchType="BLUR",this._publicState=null,this._fieldStates=r.reactive({}),this._publicFieldStates=null,this._virtualFieldStates=r.reactive({}),this._publicVirtualFieldStates=null,this.fieldsKeys=r.ref([]),this.fields=new Map,this.virtualFieldsKeys=r.ref([]),this.virtualFields=new Map,this.cacheFields=[],this.cacheVirtualFields=[],this.stopStateWatcher=null,this.stopStatusWatcher=null,this.stopValidatingWatcher=null,this.waiters=[],this.subscribers=[],this.isMounted=!1,this.readonly=!1,this.submitFlag=0,this.runInAction=i=>{i()};const{initValues:s={}}=t;this.initValues=r.toRaw(s),this.defaultValues=r.toRaw(t.defaultValues),this._state=r.reactive({values:s,defaultValues:t.defaultValues||s,fieldErrors:{},virtualErrors:{},error:null,fieldError:null,virtualError:null,isError:!1,isFieldError:!1,isVirtualError:!1,isValidating:!1,isFieldValidating:!1,isVirtualValidating:!1,isDirty:!1,isTouched:!1,isChanged:!1,isSubmitted:!1,isSubmitting:!1,submitCount:0}),this.touchType=t.touchType||"BLUR",this.readonly=t.readonly||!1}get state(){return this.readonly?(this._publicState||(this._publicState=r.readonly(this._state)),this._publicState):this._state}get fieldStates(){return this.readonly?(this._publicFieldStates||(this._publicFieldStates=r.readonly(this._fieldStates)),this._publicFieldStates):this._fieldStates}get virtualFieldStates(){return this.readonly?(this._publicVirtualFieldStates||(this._publicVirtualFieldStates=r.readonly(this._virtualFieldStates)),this._publicVirtualFieldStates):this._virtualFieldStates}mount(){if(this.isMounted)return;const{cacheFields:t,cacheVirtualFields:s}=this;this.fieldsKeys.value.push(...t),this.virtualFieldsKeys.value.push(...s);for(const i of t){const a=this.fields.get(i);a==null||a.initWatcher()}for(const i of s){const a=this.virtualFields.get(i);a==null||a.initWatcher()}this.cacheFields=[],this.cacheVirtualFields=[],this.stopStateWatcher=r.watchEffect(()=>{const i=this.fieldsKeys.value,a=this.virtualFieldsKeys.value;let n=!1,l=!1,c=!1,m=!1,p=!1,y=!1,_=!1,V=null,w=null;const E={},S={},v={},K={};i.forEach(o=>{const u=this.fields.get(o);if(!u)return;const f=u.state,h=u.state.error,g=u.state.isError,x=u.state.isValidating,I=u.state.isDirty,T=u.state.isTouched,L=u.state.isChanged;C(E,o,h),C(S,o,f),g&&(n=!0),x&&(c=!0),I&&(p=!0),T&&(y=!0),L&&(_=!0),h&&!V&&(V=h)}),a.forEach(o=>{const u=this.virtualFields.get(o);if(!u)return;const f=u.state,h=u.state.error,g=u.state.isError,x=u.state.isValidating;C(v,o,h),C(K,o,f),g&&(l=!0),x&&(m=!0),h&&!w&&(w=h)}),this.runInAction(()=>{R(this._state.fieldErrors,E),R(this._state.virtualErrors,v),R(this._fieldStates,S),R(this._virtualFieldStates,K),this._state.isFieldError=n,this._state.isVirtualError=l,this._state.isError=n||l,this._state.fieldError=V,this._state.virtualError=w,this._state.error=V||w,this._state.isFieldValidating=c,this._state.isVirtualValidating=m,this._state.isValidating=c||m,this._state.isDirty=p,this._state.isTouched=y,this._state.isChanged=_})}),this.stopValidatingWatcher=r.watchEffect(()=>{this._state.isValidating||this.waiters.forEach(a=>{a()}),this.waiters=[]}),this.isMounted=!0}unmount(){var t,s,i;(t=this.stopStateWatcher)==null||t.call(this),(s=this.stopStatusWatcher)==null||s.call(this),(i=this.stopValidatingWatcher)==null||i.call(this);for(const a of this.fieldsKeys.value)this.unregisterField(a);for(const a of this.virtualFieldsKeys.value)this.unregisterVirtualField(a);for(const a of this.cacheFields)this.unregisterField(a);for(const a of this.cacheVirtualFields)this.unregisterVirtualField(a);this.isMounted=!1}registerField(t,s={}){const{immediate:i=!0}=s,{fieldsKeys:a,fields:n}=this;if(a.value.includes(t))return console.warn(`Duplicate field <${t}>.`),{field:this.fields.get(t),register:()=>{}};for(const m of a.value)if(m.startsWith(`${t}.`)||t.startsWith(`${m}.`))return console.warn(`Fields can not be nested together: <${t}> <${m}>. If you want do this, please use [registerVirtualField]`),{field:this.fields.get(t),register:()=>{}};const l=new z(this,U(D({},s),{name:t})),c=()=>{n.set(t,l),this.runInAction(()=>{this.isMounted?(this.fieldsKeys.value.push(t),l.initWatcher()):this.cacheFields.push(t)})};return i?(c(),{field:l,register:()=>{}}):{register:c,field:l}}registerVirtualField(t,s={}){const{immediate:i=!0}=s,{virtualFieldsKeys:a,virtualFields:n}=this;if(a.value.includes(t))return console.warn(`Duplicate virtual field <${t}>.`),{field:this.virtualFields.get(t),register:()=>{}};const l=new j(this,U(D({},s),{name:t})),c=()=>{n.set(t,l),this.runInAction(()=>{this.isMounted?(this.virtualFieldsKeys.value.push(t),l.initWatcher()):this.cacheVirtualFields.push(t)})};return i?(c(),{field:l,register:()=>{}}):{register:c,field:l}}unregisterField(t,s={}){const{removeValue:i=!1}=s,{fields:a}=this,n=a.get(t);if(!!n){if(n.onUnregister(),this.isMounted){const l=this.fieldsKeys.value.indexOf(t);l!==-1&&this.fieldsKeys.value.splice(l,1)}else{const l=this.cacheFields.indexOf(t);l!==-1&&this.cacheFields.splice(l,1)}this.runInAction(()=>{i&&$(this._state.values,t),i&&$(this._state.defaultValues,t),$(this._state.fieldErrors,t),$(this._fieldStates,t)}),a.delete(t)}}unregisterVirtualField(t){const{virtualFields:s}=this,i=s.get(t);if(!!i){if(i.onUnregister(),this.isMounted){const a=this.virtualFieldsKeys.value.indexOf(t);a!==-1&&this.virtualFieldsKeys.value.splice(a,1)}else{const a=this.cacheVirtualFields.indexOf(t);a!==-1&&this.cacheVirtualFields.splice(a,1)}this.runInAction(()=>{$(this._state.virtualErrors,t),$(this._virtualFieldStates,t)}),s.delete(t)}}setPathValue(t,s){if(s===void 0)return;if(!this.fields.get(t)){console.warn(`Field not exists <${t}>.`);return}this.notify("UPDATE",t)}setValue(t,s){const i=this.fields.get(t);if(!i){console.warn(`Field not exists <${t}>.`);return}const n=r.toRaw(F(this._state.values,t))!==r.toRaw(s);this.setPathValue(t,s),i.onChanged(i.state.isChanged||n)}deletePathValue(t){if(!this.fields.get(t)){console.warn(`Field not exists <${t}>.`);return}$(this._state.values,t),this.notify("DELETE",t)}deleteValue(t){this.deletePathValue(t)}getValue(t){return r.computed(()=>F(this._state.values,t))}setTouched(t,s=!0){const i=this.fields.get(t);if(!i){console.warn(`Field not exists <${t}>.`);return}i.onTouched(s)}setFocus(t){const s=this.fields.get(t);if(!s){console.warn(`Field not exists <${t}>.`);return}s.onFocus()}submit(t,s){const i=this.submitFlag,a=()=>{if(i===this.submitFlag){if(this.runInAction(()=>{this._state.isSubmitting=!1}),this._state.isError){s(r.toRaw(this._state.error));return}this.runInAction(()=>{this._state.isSubmitted=!0}),t(r.toRaw(this._state.values))}};this.runInAction(()=>{this._state.submitCount++,this._state.isSubmitting=!0}),this._state.isValidating?this.waiters.push(()=>{a()}):a()}reset(t={}){this.waiters=[],this.runInAction(()=>{t.values?(this._state.values=r.toRaw(t.values),this.initValues=r.toRaw(t.values)):t.keepValues||(this._state.values=this.initValues),t.defaultValues?(this._state.defaultValues=r.toRaw(t.defaultValues),this.defaultValues=t.defaultValues):t.keepDefaultValues||(this._state.defaultValues=this.initValues||this.defaultValues),this.submitFlag++,this._state.isSubmitting=!1,this._state.submitCount=t.keepSubmitCount?this._state.submitCount:0,this._state.isSubmitted=t.keepIsSubmitted?this._state.isSubmitted:!1});for(const[,s]of this.fields)s.reset({keepTouched:t.keepTouched,keepChanged:t.keepChanged});this.notify("RESET")}resetField(t,s={}){const i=this.fields.get(t);if(!i){console.warn(`Field not exists <${t}>.`);return}if("defaultValue"in s&&C(this._state.defaultValues,t,r.toRaw(s.defaultValue)),"value"in s)C(this._state.values,t,r.toRaw(s.value));else if(!s.keepValue){const a=F(this._state.defaultValues,t);C(this._state.values,t,r.toRaw(a))}i.reset({keepTouched:s.keepTouched,keepChanged:s.keepChanged})}subscribe(t){return this.subscribers.push(t),()=>{const i=this.subscribers.indexOf(t);i!==-1&&this.subscribers.splice(i,1)}}notify(t,s){this.subscribers.forEach(i=>{i(t,s)})}}const lt=e=>new O(e),B=e=>{const{form:t,name:s}=e,i=r.computed(()=>e.touchType?r.unref(e.touchType):t.touchType||"BLUR"),a=r.ref(!1),n=r.ref(null),l=o=>n.value=o,c=o=>{var f,h;const u=typeof o=="object"&&typeof o.currentTarget=="object"&&((f=o.currentTarget)==null?void 0:f.value)!==void 0?(h=o.currentTarget)==null?void 0:h.value:o;t.setValue(r.unref(s),u)},m=()=>{i.value==="BLUR"&&t.setTouched(r.unref(s),!0)},p=()=>{i.value==="FOCUS"&&t.setTouched(r.unref(s),!0)};let{register:y,field:_}=t.registerField(r.unref(s),{rules:r.unref(e.rules),transform:e.transform,immediate:!1,onFocus:()=>{var o,u;(u=(o=n.value)==null?void 0:o.focus)==null||u.call(o)}});const V=r.ref(F(t.state.values,r.unref(e.name))),w=r.ref(_.state),E=r.watch(()=>[r.unref(e.name),r.unref(e.rules)],([o,u],[f])=>{console.log("watch a",o,u),t.unregisterField(f);const h=t.registerField(o,{rules:u,transform:e.transform,isEqual:e.isEqual,immediate:a.value,onFocus:()=>{var g,x;(x=(g=n.value)==null?void 0:g.focus)==null||x.call(g)}});y=h.register,_=h.field,w.value=h.field.state,V.value=F(t.state.values,r.unref(e.name))}),S=r.watch(()=>F(t.state.values,r.unref(e.name)),o=>{V.value=o,console.log("watch b",o)}),v=r.watch(()=>V.value,o=>{console.log("watch m",o);const u=F(t.state.values,r.unref(e.name));r.toRaw(u)!==r.toRaw(o)&&(V.value=o)});return r.onMounted(()=>{y==null||y(),a.value=!0}),r.onUnmounted(()=>{t.unregisterField(r.unref(s)),E(),S(),v(),n.value=null}),[r.reactive({get value(){return V.value},onChange:c,onBlur:m,onFocus:p,ref:l}),{model:V,state:w,mounted:a}]},N=e=>{const{form:t,name:s}=e,i=r.ref(!1);let{register:a,field:n}=t.registerVirtualField(r.unref(s),{rules:r.unref(e.rules),immediate:!1});const l=r.ref(n.state),c=r.watch(()=>r.unref(e.name),(m,p)=>{t.unregisterVirtualField(p);const y=t.registerVirtualField(r.unref(s),{rules:r.unref(e.rules),immediate:i.value});a=y.register,n=y.field,l.value=y.field.state});return r.onMounted(()=>{a(),i.value=!0}),r.onUnmounted(()=>{t.unregisterVirtualField(r.unref(s)),c()}),{state:l,mounted:i}},Z=(e,t)=>{let s=0;const i=e.getValue(t);Array.isArray(i.value)||e.setPathValue(t,[]);const n=i.value.map(()=>({id:`${s++}`}));let l=n.map(o=>o.id);const c=r.ref(n),m={},p=r.watch(()=>[...F(e.state.values,t)],(o,u)=>{const f=[...u],h=o.map(g=>{const x=r.toRaw(g),I=f.findIndex(L=>r.toRaw(L)===x);let T="";return I===-1?T=`${s++}`:(T=l[I],f[I]=m),{id:`${T}`}});c.value=h,l=h.map(g=>g.id)});return{onCleanup:()=>{p()},get fieldsValue(){return c.value},fields:c,prepend:o=>{const u=F(e.state.values,t);!Array.isArray(u)||u.unshift(o)},append:o=>{const u=F(e.state.values,t);!Array.isArray(u)||u.push(o)},insert:(o,u)=>{const f=c.value.findIndex(g=>g.id===o);if(f===-1)return;const h=F(e.state.values,t);!Array.isArray(h)||h.splice(f,0,u)},swap:(o,u)=>{const f=c.value.findIndex(I=>I.id===o),h=c.value.findIndex(I=>I.id===u);if(f===-1||h===-1)return;const g=F(e.state.values,t);if(!Array.isArray(g))return;const x=g[h];g[h]=g[f],g[f]=x},move:(o,u)=>{const f=c.value.findIndex(x=>x.id===o),h=c.value.findIndex(x=>x.id===u);if(f===-1||h===-1||f===h)return;const g=F(e.state.values,t);!Array.isArray(g)||(g.splice(h,0,g[f]),g.splice(h>f?f:f+1))},replace:o=>{l=[],e.setPathValue(t,o)},remove:o=>{const u=c.value.findIndex(h=>h.id===o);if(u===-1)return;const f=F(e.state.values,t);!Array.isArray(f)||f.splice(u,0)},update:(o,u)=>{const f=c.value.findIndex(g=>g.id===o);if(f===-1)return;const h=F(e.state.values,t);!Array.isArray(h)||h.splice(f,0,u)}}},ot=(e,t)=>{const a=Z(e,t),{onCleanup:s}=a,i=q(a,["onCleanup"]);return r.onUnmounted(()=>s()),i},ut=r.defineComponent({props:{form:{type:Object,required:!0},name:{type:String,required:!0},rules:{type:Array,default:()=>[]},value:{type:P,default:void 0},defaultValue:{type:P,default:void 0},transform:{type:Function,default:void 0},touchType:{type:String,default:"BLUR"}},setup(e){const t=e,y=r.toRefs(t),{form:s,rules:i,transform:a,name:n}=y,l=q(y,["form","rules","transform","name"]),[c,{mounted:m,state:p}]=B(D({form:s.value,rules:i.value,transform:a==null?void 0:a.value,name:n},l));return(_,V)=>r.unref(m)?r.renderSlot(_.$slots,"default",{key:0,field:r.unref(c),state:r.unref(p)}):r.createCommentVNode("",!0)}}),ct=r.defineComponent({props:{form:{type:Object,required:!0},name:{type:String,required:!0},rules:{type:Array,default:()=>[]}},setup(e){const t=e,{name:s,form:i,rules:a}=r.toRefs(t),{state:n,mounted:l}=N({form:i.value,rules:a.value,name:s});return(c,m)=>r.unref(l)?r.renderSlot(c.$slots,"default",{key:0,state:r.unref(n)}):r.createCommentVNode("",!0)}});d.Field=ut,d.FieldClass=z,d.FormClass=O,d.VirtualField=ct,d.VirtualFieldClass=j,d.createFieldArray=Z,d.createForm=lt,d.useField=B,d.useFieldArray=ot,d.useVirtualField=N,d.validators=k,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
