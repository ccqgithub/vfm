import{Z as z,I as A,a7 as V,a8 as W,a9 as Y,aa as S,j,J as D,f as K,p as H,h as m,v as U,l as J,s as ee,a2 as te,R as N,a0 as se,a3 as ie}from"../app.013fa85b.mjs";const ae=s=>{const e="{{name}} is not alphabetical";return typeof s!="string"?e:/^[a-zA-Z]*$/.test(s)?"":e},re=s=>{const e="{{name}} must be alpha-numeric";return typeof s!="string"&&typeof s!="number"?e:/^[a-zA-Z0-9]*$/.test(`${s}`)?"":e},le=s=>{const e="{{name}} must be decimal";return typeof s!="string"&&typeof s!="number"?e:/^[-]?\d*(\.\d+)?$/.test(`${s}`)?"":e},ne=/^(?:[A-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]{2,}(?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i,ue=s=>{const e="{{name}} is not a valid email address";return typeof s!="string"?e:ne.test(s)?"":e},oe=s=>{const e="{{name}} is not an integer";return typeof s!="string"&&typeof s!="number"?e:/(^[0-9]*$)|(^-[0-9]+$)/.test(`${s}`)?"":e},de=s=>{const e="{{name}} is not a valid IP address";if(typeof s!="string")return e;const t=s.split(".");return t.length===4&&t.every(ce)?"":e},ce=s=>{if(s.length>3||s.length===0||s[0]==="0"&&s!=="0"||!s.match(/^\d+$/))return!1;const e=+s;return e>=0&&e<=255},he=s=>{const e="{{name}} is not a valid MAC Address";if(typeof s!="string")return e;const t=":",i=s.split(t);return(i.length===6||i.length===8)&&i.every(fe)?"":e},fe=s=>s.toLowerCase().match(/^[0-9a-f]{2}$/),ve=s=>{const e="{{name}} must be numeric";return typeof s!="string"&&typeof s!="number"?e:/^-?\d*(\.\d+)?$/.test(`${s}`)?"":e},C={alpha:ae,alphaNum:re,decimal:le,email:ue,integer:oe,ipAddress:de,macAddress:he,numeric:ve},x=(s,e,t)=>{const i=e.split(".");let a=s;for(;i.length&&typeof a=="object"&&a!==null;){const r=i.shift();i.length===0?a[r]=t:(typeof a[r]!="object"||a[r]===null)&&(a[r]=/^\d+$/.test(r)?[]:{}),a=a[r]}},g=(s,e)=>{const t=e.split(".");let i=s;for(;t.length&&i;){const a=t.shift();i=typeof i=="object"&&i!==null?i[a]:void 0}return i},T=(s,e)=>{const t=e.split(".");let i=s;for(;t.length&&typeof i=="object"&&i!==null;){const a=t.shift();t.length===0?Array.isArray(i)?/^\d+$/.test(a)&&i.splice(Number(a),1):delete i[a]:i=i[a]}},M=(s,e,t=!0)=>{const i=Object.keys(s),a=Object.keys(e),r=i.filter(l=>!a.includes(l));t&&r.forEach(l=>{delete s[l]}),a.forEach(l=>{typeof s[l]=="object"&&!Array.isArray(s[l])&&s[l]!==null&&typeof e[l]=="object"&&!Array.isArray(e[l])&&e[l]!==null?M(s[l],e[l],t):s[l]=e[l]})},B=[String,Number,Boolean,Symbol,Array,Object],q=s=>{let e=[];const i=s(r=>{e.push(r)});return{promise:new Promise((r,l)=>{i.then(n=>{e=[],r(n)},n=>{e=[],l(n)})}),dispose:()=>{e.forEach(r=>r()),e=[]}}},P=(s,e)=>{let t=null,i=null,a=[];return async(...l)=>(t==null||t(),a.push(new Promise((n,u)=>{let o=null;const h=setTimeout(()=>{const d=s(...l);"promise"in d?(d.promise.then(n,u),o=()=>{var p;(p=d.dispose)==null||p.call(d)}):d.then(n,u)},e);t=()=>{o==null||o(),o=null,clearTimeout(h),u()}})),i||(i=(async()=>{for(;a.length;){const n=a.shift();try{const u=await n;if(!a.length)return u}catch(u){if(!a.length)throw u}}})(),i.finally(()=>{t=null,i=null,a=[]})))},Z=(s,e,t)=>q(async i=>{if(s.required&&!e&&e!==0||s.requiredLength&&(typeof(e==null?void 0:e.length)!="number"||e.length<=0))return"{{name}} is required";if(s.minLength!==void 0&&(typeof(e==null?void 0:e.length)!="number"||e.length<s.minLength))return`{{name}}'s length cannot be less than ${s.minLength}`;if(s.maxLength!==void 0&&(typeof(e==null?void 0:e.length)!="number"||e.length>s.maxLength))return`{{name}}'s length cannot be greater than ${s.maxLength}`;if(s.min!==void 0&&(typeof e!="number"||e<s.min))return`{{name}} cannot be less than ${s.min}`;if(s.max!==void 0&&(typeof e!="number"||e>s.max))return`{{name}} cannot be greater than ${s.max}`;if(s.pattern&&(typeof e!="string"&&typeof e!="number"||!s.pattern.test(`${e}`)))return`{{name}} not match ${s.pattern.toString()}`;const a=Object.keys(C);for(const r of a)if(s[r]===!0){const l=C[r],n=l(e,t);typeof n=="object"&&"dispose"in n&&typeof n.dispose=="function"&&i(()=>{var o;return(o=n.dispose)==null?void 0:o.call(n)});const u=typeof n=="object"&&"promise"in n?await n.promise:await n;if(u)return u}if(s.validator){const r=s.validator(e,t);typeof r=="object"&&"dispose"in r&&typeof r.dispose=="function"&&i(()=>{var n;return(n=r.dispose)==null?void 0:n.call(r)});const l=typeof r=="object"&&"promise"in r?await r.promise:await r;if(l)return l}return""});class pe{constructor(e,t){this.rules=A([]),this.deps=null,this.validateDispose=null,this.debounce=0,this.transform=null,this.isEqual=null,this.focusFn=null,this.stopValidateWatcher=null,this.stopDirtyWatcher=null,this.isRegistered=!1,this.isInited=!1,this.runInAction=r=>{r()};const{immediate:i=!0}=t;this.form=e,this.name=t.name,this.setRules(t.rules||[]),this.deps=t.deps||null,this.transform=t.transform||null,this.isEqual=t.isEqual||null,this.focusFn=t.onFocus||null,this.debounce=t.debounce||0,this.initValue=t.initValue,this.initDefaultValue=t.initDefaultValue,this.state=W({error:null,isError:!1,isValidating:!1,isDirty:!1,isTouched:!1,isChanged:!1});const a=(r,l,n)=>{const u=this.transform;let o=!1;return q(async h=>{h(()=>{o=!0});for(const d of n){const p=Z(d,u&&r!==void 0?u(r):r,l);h(()=>{var $;return($=p.dispose)==null?void 0:$.call(p)});const y=await p.promise;if(o)return null;let E=null;if(y)return E=typeof y=="string"?{type:d.type,message:y}:y,E.message=E.message.replace(/\{\{name\}\}/g,this.name),d.message!==void 0&&(E.message=d.message.replace(/\{\{name\}\}/g,this.name)),E}return null})};this.validate=a,i&&this.onRegister()}getValue(){return g(this.form.state.values,this.name)}getDefaultValue(){return g(this.form.state.defaultValues,this.name)}setRules(e=[]){this.rules.value=e.map(t=>t.debounce?{validator:P((a,r)=>Z(t,a,r),t.debounce)}:t)}update(e={}){e.rules&&this.setRules(e.rules)}initWatcher(){if(this.isInited)return;const e=async i=>{var a;(a=this.validateDispose)==null||a.call(this),this.validateDispose=null;const{value:r,deps:l,rules:n}=i;let u=!1;const o=this.validate(r,l,n);this.validateDispose=()=>{var d;(d=o.dispose)==null||d.call(o),u=!0,this.validateDispose=null};const h=await o.promise;u||(this.runInAction(()=>{this.state.isValidating=!1;const d=!!(h!=null&&h.message);d?(this.state.error||(this.state.error={message:""}),this.state.error.message=(h==null?void 0:h.message)||"",this.state.error.type=h==null?void 0:h.type):this.state.error=null,this.state.isError=d}),this.validateDispose=null)},t=this.debounce?P(e,this.debounce):e;this.stopValidateWatcher=S(()=>{var i;this.runInAction(()=>{this.state.isValidating=!0});const a=this.getValue(),r=(i=this.deps)==null?void 0:i.call(this),l=this.rules.value;Promise.resolve().then(()=>{t({value:a,deps:r,rules:l})})}),this.stopDirtyWatcher=S(()=>{const i=this.getValue(),a=this.getDefaultValue();this.runInAction(()=>{const r=this.isEqual||((l,n)=>l===n);this.state.isDirty=!r(V(i),V(a))})}),this.isInited=!0}onRegister(){this.isRegistered||(this.initWatcher(),this.isRegistered=!0)}onUnregister(){var e,t,i;(e=this.validateDispose)==null||e.call(this),this.validateDispose=null,(t=this.stopValidateWatcher)==null||t.call(this),(i=this.stopDirtyWatcher)==null||i.call(this),this.isRegistered=!1,this.isInited=!1}onTouched(e=!0){this.runInAction(()=>{this.state.isTouched=e})}onChanged(e=!0){this.state.isChanged=e}onFocus(){var e;(e=this.focusFn)==null||e.call(this)}reset(e={}){var t,i,a;(t=this.validateDispose)==null||t.call(this),this.validateDispose=null,(i=this.stopValidateWatcher)==null||i.call(this),(a=this.stopDirtyWatcher)==null||a.call(this),this.runInAction(()=>{const{keepChanged:r=!1,keepTouched:l=!1}=e;this.state.error=null,this.state.isError=!1,this.state.isValidating=!1,this.state.isDirty=!1,this.state.isTouched=l?this.state.isTouched:!1,this.state.isChanged=r?this.state.isChanged:!1}),this.isInited=!1,this.initWatcher()}}const G=(s,e)=>q(async t=>{if(s.required&&!e&&e!==0||s.requiredLength&&(typeof(e==null?void 0:e.length)!="number"||e.length<=0))return"{{name}} is required";if(s.minLength!==void 0&&(typeof(e==null?void 0:e.length)!="number"||e.length<s.minLength))return`{{name}}'s length cannot be less than ${s.minLength}`;if(s.maxLength!==void 0&&(typeof(e==null?void 0:e.length)!="number"||e.length>s.maxLength))return`{{name}}'s length cannot be greater than ${s.maxLength}`;if(s.min!==void 0&&(typeof e!="number"||e<s.min))return`{{name}} cannot be less than ${s.min}`;if(s.max!==void 0&&(typeof e!="number"||e>s.max))return`{{name}} cannot be greater than ${s.max}`;if(s.pattern&&(typeof e!="string"&&typeof e!="number"||!s.pattern.test(`${e}`)))return`{{name}} not match ${s.pattern.toString()}`;const i=Object.keys(C);for(const a of i)if(s[a]===!0){const r=C[a],l=r(e);typeof l=="object"&&"dispose"in l&&typeof l.dispose=="function"&&t(()=>{var u;return(u=l.dispose)==null?void 0:u.call(l)});const n=typeof l=="object"&&"promise"in l?await l.promise:await l;if(n)return n}if(s.validator){const a=s.validator(e);typeof a=="object"&&"dispose"in a&&typeof a.dispose=="function"&&t(()=>{var l;return(l=a.dispose)==null?void 0:l.call(a)});const r=typeof a=="object"&&"promise"in a?await a.promise:await a;if(r)return r}return""});class me{constructor(e,t){this.name="",this.rules=A([]),this.validateDispose=null,this.debounce=0,this.stopValidateWatcher=null,this.isRegistered=!1,this.isInited=!1,this.runInAction=r=>{r()};const{immediate:i=!0}=t;this.form=e,this.name=t.name,this.value=t.value,this.setRules(t.rules||[]),this.debounce=t.debounce||0,this.state=W({name:this.name,error:null,isError:!1,isValidating:!1});const a=(r,l)=>{let n=!1;return q(async u=>{u(()=>{n=!0});for(const o of l){const h=G(o,r);u(()=>{var y;return(y=h.dispose)==null?void 0:y.call(h)});const d=await h.promise;if(n)return null;let p=null;if(d)return p=typeof d=="string"?{type:o.type,message:d}:d,p.message=p.message.replace(/\{\{name\}\}/g,this.name),o.message!==void 0&&(p.message=o.message.replace(/\{\{name\}\}/g,this.name)),p}return null})};this.validate=a,i&&this.initWatcher()}setRules(e=[]){this.rules.value=e.map(t=>t.debounce?{validator:P(a=>G(t,a),t.debounce)}:t)}update(e){e.rules&&this.setRules(e.rules),e.value&&(this.value=e.value)}initWatcher(){var e;if(this.isInited)return;(e=this.validateDispose)==null||e.call(this),this.validateDispose=null;const t=async a=>{this.runInAction(()=>{this.state.isValidating=!0});const{value:r,rules:l}=a;let n=!1;const u=this.validate(r,l);this.validateDispose=()=>{var h;(h=u.dispose)==null||h.call(u),n=!0,this.validateDispose=null};const o=await u.promise;n||(this.runInAction(()=>{this.state.isValidating=!1;const h=!!(o!=null&&o.message);h?(this.state.error||(this.state.error={message:""}),this.state.error.message=(o==null?void 0:o.message)||"",this.state.error.type=o==null?void 0:o.type):this.state.error=null,this.state.isError=h}),this.validateDispose=null)},i=this.debounce?P(t,this.debounce):t;this.stopValidateWatcher=S(()=>{const a=this.value(),r=this.rules.value;Promise.resolve().then(()=>{i({value:a,rules:r})})}),this.isInited=!0}onRegister(){this.isRegistered||(this.initWatcher(),this.isRegistered=!0)}onUnregister(){var e,t;(e=this.validateDispose)==null||e.call(this),this.validateDispose=null,(t=this.stopValidateWatcher)==null||t.call(this),this.isRegistered=!1,this.isInited=!1}}class ye{constructor(e){this.touchType="BLUR",this._publicState=null,this.fieldsKeys=A([]),this.fields=new Map,this.virtualFieldsKeys=A([]),this.virtualFields=new Map,this.cacheFields=[],this.cacheVirtualFields=[],this.stopStateWatcher=null,this.stopStatusWatcher=null,this.stopValidatingWatcher=null,this.waiters=[],this.subscribers=[],this.isMounted=!1,this.readonly=!1,this.submitFlag=0,this.runInAction=i=>{i()};const{initValues:t={}}=e;this.initValues=V(t),this.defaultValues=V(e.defaultValues||e.initValues),this._state=W({values:t,defaultValues:e.defaultValues||t,fieldErrors:{},virtualErrors:{},error:null,fieldError:null,virtualError:null,isError:!1,isFieldError:!1,isVirtualError:!1,isValidating:!1,isFieldValidating:!1,isVirtualValidating:!1,isDirty:!1,isTouched:!1,isChanged:!1,isSubmitted:!1,isSubmitting:!1,submitCount:0}),this.touchType=e.touchType||"BLUR",this.readonly=e.readonly||!1}get state(){return this.readonly?(this._publicState||(this._publicState=Y(this._state)),this._publicState):this._state}mount(){if(this.isMounted)return;const{cacheFields:e,cacheVirtualFields:t}=this;for(const i of e){const a=this.fields.get(i);a.initWatcher(),a.initDefaultValue!==void 0&&x(this._state.defaultValues,i,a.initDefaultValue),a.initValue!==void 0&&x(this._state.values,i,a.initValue)}for(const i of t){const a=this.virtualFields.get(i);a==null||a.initWatcher()}this.cacheFields=[],this.cacheVirtualFields=[],this.fieldsKeys.value.push(...e),this.virtualFieldsKeys.value.push(...t),this.stopStateWatcher=S(()=>{const i=this.fieldsKeys.value,a=this.virtualFieldsKeys.value;let r=!1,l=!1,n=!1,u=!1,o=!1,h=!1,d=!1,p=null,y=null;const E={},$={};i.forEach(w=>{const F=this.fields.get(w);if(!F)return;const f=F.state.error,c=F.state.isError,v=F.state.isValidating,b=F.state.isDirty,_=F.state.isTouched,I=F.state.isChanged;x(E,w,f),c&&(r=!0),v&&(n=!0),b&&(o=!0),_&&(h=!0),I&&(d=!0),f&&!p&&(p=f)}),a.forEach(w=>{const F=this.virtualFields.get(w);if(!F)return;const f=F.state.error,c=F.state.isError,v=F.state.isValidating;x($,w,f),c&&(l=!0),v&&(u=!0),f&&!y&&(y=f)}),this.runInAction(()=>{M(this._state.fieldErrors,E),M(this._state.virtualErrors,$),this._state.isFieldError=r,this._state.isVirtualError=l,this._state.isError=r||l,this._state.fieldError=p,this._state.virtualError=y,this._state.error=p||y,this._state.isFieldValidating=n,this._state.isVirtualValidating=u,this._state.isValidating=n||u,this._state.isDirty=o,this._state.isTouched=h,this._state.isChanged=d})}),this.stopValidatingWatcher=S(()=>{this._state.isValidating||this.waiters.forEach(a=>{a()}),this.waiters=[]}),this.isMounted=!0}unmount(){var e,t,i;(e=this.stopStateWatcher)==null||e.call(this),(t=this.stopStatusWatcher)==null||t.call(this),(i=this.stopValidatingWatcher)==null||i.call(this);const a=[...this.fieldsKeys.value];for(const l of a)this.unregisterField(l);const r=[...this.virtualFieldsKeys.value];for(const l of r)this.unregisterVirtualField(l);for(const l of this.cacheFields)this.unregisterField(l);for(const l of this.cacheVirtualFields)this.unregisterVirtualField(l);this.subscribers=[],this.reset({values:V(this.initValues),defaultValues:V(this.defaultValues)}),this.isMounted=!1}registerField(e,t={}){const{immediate:i=!0,value:a=g(this.initValues,e),defaultValue:r=g(this.defaultValues||{},e)}=t,{fieldsKeys:l,fields:n,cacheFields:u}=this;if(l.value.includes(e)||u.includes(e))return console.warn(`Duplicate field <${e}>.`),{field:this.fields.get(e),register:()=>{}};for(const d of[...l.value,...u])if(d.startsWith(`${e}.`)||e.startsWith(`${d}.`))return console.warn(`Fields can not be nested together: <${e}> <${d}>. If you want do this, please use [registerVirtualField]`),{field:this.fields.get(e),register:()=>{}};const o=new pe(this,{...t,name:e,initValue:a,initDefaultValue:r});n.set(e,o);const h=()=>{this.runInAction(()=>{this.isMounted?(r!==void 0&&x(this._state.defaultValues,e,r),a!==void 0&&x(this._state.values,e,r),this.fieldsKeys.value.push(e),o.initWatcher()):this.cacheFields.push(e)})};return i?(h(),{field:o,register:()=>{}}):{register:h,field:o}}registerVirtualField(e,t){const{immediate:i=!0}=t,{virtualFieldsKeys:a,virtualFields:r,cacheVirtualFields:l}=this;if(a.value.includes(e)||l.includes(e))return console.warn(`Duplicate virtual field <${e}>.`),{field:this.virtualFields.get(e),register:()=>{}};const n=new me(this,{...t,name:e});r.set(e,n);const u=()=>{this.runInAction(()=>{this.isMounted?(this.virtualFieldsKeys.value.push(e),n.initWatcher()):this.cacheVirtualFields.push(e)})};return i?(u(),{field:n,register:()=>{}}):{register:u,field:n}}unregisterField(e,t={}){const{removeValue:i=!1}=t,{fields:a}=this,r=a.get(e);if(!!r){if(r.onUnregister(),this.isMounted){const l=this.fieldsKeys.value.indexOf(e);l!==-1&&this.fieldsKeys.value.splice(l,1)}else{const l=this.cacheFields.indexOf(e);l!==-1&&this.cacheFields.splice(l,1)}this.runInAction(()=>{i&&T(this._state.values,e),i&&T(this._state.defaultValues,e),T(this._state.fieldErrors,e)}),a.delete(e)}}unregisterVirtualField(e){const{virtualFields:t}=this,i=t.get(e);if(!!i){if(i.onUnregister(),this.isMounted){const a=this.virtualFieldsKeys.value.indexOf(e);a!==-1&&this.virtualFieldsKeys.value.splice(a,1)}else{const a=this.cacheVirtualFields.indexOf(e);a!==-1&&this.cacheVirtualFields.splice(a,1)}this.runInAction(()=>{T(this._state.virtualErrors,e)}),t.delete(e)}}setPathValue(e,t){x(this._state.values,e,t),this.notify("UPDATE",e)}setValue(e,t){const i=this.fields.get(e);if(!i){console.warn(`Field not exists <${e}>.`);return}const r=V(g(this._state.values,e))!==V(t);this.setPathValue(e,t),i.onChanged(i.state.isChanged||r)}deletePathValue(e){T(this._state.values,e),this.notify("DELETE",e)}deleteValue(e){if(!this.fields.get(e)){console.warn(`Field not exists <${e}>.`);return}this.deletePathValue(e)}getPathValueRef(e){return j(()=>g(this.state.values,e))}getValueRef(e){return j(()=>{if(!this.fieldsKeys.value.includes(e)){console.warn(`Field not exists <${e}>.`);return}return g(this.state.values,e)})}getPathValue(e){return g(this.state.values,e)}getValue(e){if(!this.fieldsKeys.value.includes(e)){console.warn(`Field not exists <${e}>.`);return}return g(this.state.values,e)}setTouched(e,t=!0){const i=this.fields.get(e);if(!i){console.warn(`Field not exists <${e}>.`);return}i.onTouched(t)}setFocus(e){const t=this.fields.get(e);if(!t){console.warn(`Field not exists <${e}>.`);return}t.onFocus()}submit(e={}){const t=this.submitFlag,i=()=>{var a,r;if(t===this.submitFlag){if(this.runInAction(()=>{this._state.isSubmitting=!1}),this._state.isError){(a=e.onError)==null||a.call(e,V(this._state.error));return}this.runInAction(()=>{this._state.isSubmitted=!0}),(r=e.onSuccess)==null||r.call(e,V(this._state.values))}};this.runInAction(()=>{this._state.submitCount++,this._state.isSubmitting=!0}),this._state.isValidating?this.waiters.push(()=>{i()}):i()}reset(e={}){this.waiters=[],this.runInAction(()=>{e.values?(this._state.values=V(e.values),this.initValues=V(e.values)):e.keepValues||(this._state.values=this.initValues),e.defaultValues?(this._state.defaultValues=V(e.defaultValues),this.defaultValues=e.defaultValues):e.keepDefaultValues||(this._state.defaultValues=this.initValues||this.defaultValues),this.submitFlag++,this._state.isSubmitting=!1,this._state.submitCount=e.keepSubmitCount?this._state.submitCount:0,this._state.isSubmitted=e.keepIsSubmitted?this._state.isSubmitted:!1});for(const[,t]of this.fields)t.reset({keepTouched:e.keepTouched,keepChanged:e.keepChanged});this.notify("RESET")}resetField(e,t={}){const i=this.fields.get(e);if(!i){console.warn(`Field not exists <${e}>.`);return}if("defaultValue"in t&&x(this._state.defaultValues,e,V(t.defaultValue)),"value"in t)x(this._state.values,e,V(t.value));else if(!t.keepValue){const a=g(this._state.defaultValues,e);x(this._state.values,e,V(a))}i.reset({keepTouched:t.keepTouched,keepChanged:t.keepChanged})}subscribe(e){return this.subscribers.push(e),()=>{const i=this.subscribers.indexOf(e);i!==-1&&this.subscribers.splice(i,1)}}notify(e,t){this.subscribers.forEach(i=>{i(e,t)})}fieldState(e){if(!this.fieldsKeys.value.includes(e))return null;const t=this.fields.get(e);return t?t.state:null}virtualFieldState(e){if(!this.virtualFieldsKeys.value.includes(e))return null;const t=this.virtualFields.get(e);return t?t.state:null}isDirty(e){var t;return((t=this.fieldState(e))==null?void 0:t.isDirty)||!1}isTouched(e){var t;return((t=this.fieldState(e))==null?void 0:t.isTouched)||!1}isChanged(e){var t;return((t=this.fieldState(e))==null?void 0:t.isChanged)||!1}isValidating(e){var t;return((t=this.fieldState(e))==null?void 0:t.isValidating)||!1}isVirtualValidating(e){var t;return((t=this.virtualFieldState(e))==null?void 0:t.isValidating)||!1}isError(e){var t;return((t=this.fieldState(e))==null?void 0:t.isError)||!1}isVirtualError(e){var t;return((t=this.virtualFieldState(e))==null?void 0:t.isError)||!1}fieldError(e,t="anyTouched"){var i;const a=this.state.isTouched,r=this.isTouched(e);return t==="allTouched"&&(!a||!r)||t==="formTouched"&&!a||t==="fieldTouched"&&!r||t==="anyTouched"&&!r&&!a?null:((i=this.fieldState(e))==null?void 0:i.error)||null}virtualFieldError(e){var t;return((t=this.virtualFieldState(e))==null?void 0:t.error)||null}arrayAppend(e,t){const i=g(this._state.values,e);!Array.isArray(i)||(i.push(t),this.notify("UPDATE",e))}arrayPrepend(e,t){const i=g(this._state.values,e);!Array.isArray(i)||(i.unshift(t),this.notify("UPDATE",e))}arrayInsert(e,t,i){const a=g(this._state.values,e);!Array.isArray(a)||(a.splice(t,0,i),this.notify("UPDATE",e))}arraySwap(e,t,i){const a=g(this._state.values,e);if(!Array.isArray(a))return;const r=a[i];a[i]=a[t],a[t]=r,this.notify("UPDATE",e)}arrayMove(e,t,i){const a=g(this._state.values,e);!Array.isArray(a)||(a.splice(i,0,a[t]),a.splice(i>t?t:t+1),this.notify("UPDATE",e))}arrayUpdate(e,t,i){const a=g(this._state.values,e);!Array.isArray(a)||(a.splice(t,1,i),this.notify("UPDATE",e))}arrayRemove(e,t){const i=g(this._state.values,e);!Array.isArray(i)||(i.splice(t,1),this.notify("UPDATE",e))}arrayReplace(e,t){const i=g(this._state.values,e);!Array.isArray(i)||(x(this._state.values,e,t),this.notify("UPDATE",e))}}const Ie=s=>new ye(s),Q=Symbol(),O=()=>ie(Q,null),ge=s=>{const e=O(),{form:t=e,name:i}=s;if(!t)throw new Error("No provided form!");const a=j(()=>s.touchType?m(s.touchType):t.touchType||"BLUR"),r=A(!1),l=A(null),n=c=>l.value=c,u=c=>{var v,b;const _=typeof c=="object"&&typeof c.currentTarget=="object"&&((v=c.currentTarget)==null?void 0:v.value)!==void 0?(b=c.currentTarget)==null?void 0:b.value:c;t.setValue(m(i),_)},o=()=>{!r.value||a.value==="BLUR"&&t.setTouched(m(i),!0)},h=()=>{!r.value||a.value==="FOCUS"&&t.setTouched(m(i),!0)};let{register:d,field:p}=t.registerField(m(i),{rules:m(s.rules),transform:s.transform,deps:s.deps,immediate:!1,onFocus:()=>{var c,v;(v=(c=l.value)==null?void 0:c.focus)==null||v.call(c)},debounce:s.debounce,value:s.value,defaultValue:s.defaultValue});const y=A(g(t.state.values,m(s.name))),E=A(p.state),$=D(()=>[m(s.name),m(s.rules)],([c,v],[b])=>{t.unregisterField(b);const _=t.registerField(c,{rules:v,transform:s.transform,deps:s.deps,isEqual:s.isEqual,immediate:r.value,onFocus:()=>{var I,R;(R=(I=l.value)==null?void 0:I.focus)==null||R.call(I)},debounce:s.debounce,value:s.value,defaultValue:s.defaultValue});d=_.register,p=_.field,E.value=_.field.state,y.value=g(t.state.values,m(s.name))}),w=D(()=>g(t.state.values,m(s.name)),c=>{y.value=c}),F=D(()=>y.value,c=>{const v=g(t.state.values,m(s.name));V(v)!==V(c)&&(y.value=c)});return N(()=>{d==null||d(),r.value=!0}),z(()=>{r.value=!1,t.unregisterField(m(i)),$(),w(),F(),l.value=null}),[W({get value(){return y.value},onInput:u,onChange:u,onBlur:o,onFocus:h,ref:n}),y,{mounted:r}]},Ve=s=>{const e=O(),{form:t=e,name:i}=s;if(!t)throw new Error("No provided form!");const a=A(!1);let{register:r,field:l}=t.registerVirtualField(m(i),{value:s.value,rules:m(s.rules),immediate:!1,debounce:s.debounce});const n=A(l.state),u=D(()=>m(s.name),(o,h)=>{t.unregisterVirtualField(h);const d=t.registerVirtualField(m(i),{value:s.value,rules:m(s.rules),immediate:a.value,debounce:s.debounce});r=d.register,l=d.field,n.value=d.field.state});return N(()=>{r(),a.value=!0}),z(()=>{t.unregisterVirtualField(m(i)),u()}),{mounted:a}},be=(s,e)=>{let t=0,i=s.getPathValue(e);Array.isArray(i)||(s.setPathValue(e,[]),i=s.getPathValue(e));const r=i.map(f=>({id:`${t++}`,name:`${e}.${f}`}));let l=r.map(f=>f.id);const n=A(r),u={},o=D(()=>s.getPathValue(e).map(c=>V(c)),(f,c)=>{const v=[...c],b=f.map((_,I)=>{const R=V(_),L=v.findIndex(X=>V(X)===R);let k="";return L===-1?k=`${t++}`:(k=l[L],v[L]=u),{id:`${k}`,name:`${e}.${I}`}});n.value=b,l=b.map(_=>_.id)});return{onCleanup:()=>{o()},get fieldsValue(){return n.value},fields:n,prepend:f=>{s.arrayPrepend(e,f)},append:f=>{s.arrayAppend(e,f)},insert:(f,c)=>{const v=n.value.findIndex(b=>b.id===f);v!==-1&&s.arrayInsert(e,v,c)},swap:(f,c)=>{const v=n.value.findIndex(_=>_.id===f),b=n.value.findIndex(_=>_.id===c);v===-1||b===-1||s.arraySwap(e,v,b)},move:(f,c)=>{const v=n.value.findIndex(_=>_.id===f),b=n.value.findIndex(_=>_.id===c);v===-1||b===-1||v===b||s.arrayMove(e,v,b)},replace:f=>{l=[],s.arrayReplace(e,f)},remove:f=>{const c=n.value.findIndex(v=>v.id===f);c!==-1&&s.arrayRemove(e,c)},update:(f,c)=>{const v=n.value.findIndex(b=>b.id===f);v!==-1&&s.arrayUpdate(e,v,c)}}},_e=s=>{const e=O(),{form:t=e,path:i}=s;if(!t)throw new Error("No provided form!");const{onCleanup:a,...r}=be(t,i);return z(()=>a()),r},Fe=K({__name:"VirtualField",props:{form:{type:Object,default:void 0},name:{type:String,required:!0},value:{type:Function,required:!0},rules:{type:Array,default:()=>[]},debounce:{type:Number,default:void 0}},setup(s){const e=s,{name:t,form:i,value:a,rules:r,debounce:l}=H(e),{mounted:n}=Ve({form:i==null?void 0:i.value,rules:r.value,value:a.value,debounce:l==null?void 0:l.value,name:t});return(u,o)=>m(n)?U(u.$slots,"default",{key:0}):J("",!0)}}),Ee=K({__name:"FieldArray",props:{form:{type:Object,default:void 0},name:{type:String,required:!0}},setup(s){const e=s,{fieldsValue:t,fields:i,...a}=_e({form:e.form,path:e.name});return(r,l)=>U(r.$slots,"default",ee(a,{fields:m(i)}))}}),xe=K({__name:"FormProvider",props:{form:{type:Object,required:!0}},setup(s){const e=s;return te(Q,e.form),N(()=>e.form.mount()),se(()=>e.form.unmount()),(t,i)=>U(t.$slots,"default")}}),Ae=()=>({form:{type:Object,default:void 0},name:{type:String,required:!0},rules:{type:Array,default:()=>[]},deps:{type:Function,default:void 0},debounce:{type:Number,default:void 0},value:{type:B,default:void 0},defaultValue:{type:B,default:void 0},transform:{type:Function,default:void 0},touchType:{type:String,default:"BLUR"},changeType:{type:String,default:"ONCHANGE"},isEqual:{type:Function,default:void 0}}),$e=K({__name:"index",props:Ae(),setup(s){const e=s,{form:t,rules:i,transform:a,name:r,deps:l,debounce:n,changeType:u,value:o,defaultValue:h,isEqual:d,...p}=H(e),[y,,{mounted:E}]=ge({form:t==null?void 0:t.value,rules:i.value,transform:a==null?void 0:a.value,deps:l==null?void 0:l.value,debounce:n==null?void 0:n.value,name:r,changeType:u.value,value:o==null?void 0:o.value,defaultValue:h==null?void 0:h.value,isEqual:d==null?void 0:d.value,...p});return($,w)=>m(E)?U($.$slots,"default",{key:0,field:m(y)}):J("",!0)}}),Te=$e,De=Fe,Se=Ee,Re=xe;export{Te as F,De as V,Se as a,Re as b,Ie as c,_e as u};
