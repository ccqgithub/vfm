import{f as L,v as Z,I,a4 as b,a5 as G,a6 as ge,a7 as B,j as Y,Z as se,a2 as ye,R as ie,a0 as be,a3 as Ve,J as K,p as de,h as c,l as H,s as k,o as A,c as S,a as d,b as E,w as C,t as w,F as N,_ as j,k as ae,a8 as ce,a9 as fe,K as ee,aa as Fe,L as re,q as he}from"../app.b383d5e4.mjs";const $e=s=>{const e="{{name}} is not alphabetical";return typeof s!="string"?e:/^[a-zA-Z]*$/.test(s)?"":e},xe=s=>{const e="{{name}} must be alpha-numeric";return typeof s!="string"&&typeof s!="number"?e:/^[a-zA-Z0-9]*$/.test(`${s}`)?"":e},Ae=s=>{const e="{{name}} must be decimal";return typeof s!="string"&&typeof s!="number"?e:/^[-]?\d*(\.\d+)?$/.test(`${s}`)?"":e},Ee=/^(?:[A-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]{2,}(?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i,Se=s=>{const e="{{name}} is not a valid email address";return typeof s!="string"?e:Ee.test(s)?"":e},we=s=>{const e="{{name}} is not an integer";return typeof s!="string"&&typeof s!="number"?e:/(^[0-9]*$)|(^-[0-9]+$)/.test(`${s}`)?"":e},Ie=s=>{const e="{{name}} is not a valid IP address";if(typeof s!="string")return e;const t=s.split(".");return t.length===4&&t.every(Te)?"":e},Te=s=>{if(s.length>3||s.length===0||s[0]==="0"&&s!=="0"||!s.match(/^\d+$/))return!1;const e=+s;return e>=0&&e<=255},Ce=s=>{const e="{{name}} is not a valid MAC Address";if(typeof s!="string")return e;const t=":",i=s.split(t);return(i.length===6||i.length===8)&&i.every(De)?"":e},De=s=>s.toLowerCase().match(/^[0-9a-f]{2}$/),ke=s=>{const e="{{name}} must be numeric";return typeof s!="string"&&typeof s!="number"?e:/^-?\d*(\.\d+)?$/.test(`${s}`)?"":e},z={alpha:$e,alphaNum:xe,decimal:Ae,email:Se,integer:we,ipAddress:Ie,macAddress:Ce,numeric:ke},T=(s,e,t)=>{const i=e.split(".");let a=s;for(;i.length&&typeof a=="object"&&a!==null;){const l=i.shift();i.length===0?a[l]=t:(typeof a[l]!="object"||a[l]===null)&&(a[l]=/^\d+$/.test(l)?[]:{}),a=a[l]}},y=(s,e)=>{const t=e.split(".");let i=s;for(;t.length&&i;){const a=t.shift();i=typeof i=="object"&&i!==null?i[a]:void 0}return i},U=(s,e)=>{const t=e.split(".");let i=s;for(;t.length&&typeof i=="object"&&i!==null;){const a=t.shift();t.length===0?Array.isArray(i)?/^\d+$/.test(a)&&i.splice(Number(a),1):delete i[a]:i=i[a]}},te=(s,e,t=!0)=>{const i=Object.keys(s),a=Object.keys(e),l=i.filter(r=>!a.includes(r));t&&l.forEach(r=>{delete s[r]}),a.forEach(r=>{typeof s[r]=="object"&&!Array.isArray(s[r])&&s[r]!==null&&typeof e[r]=="object"&&!Array.isArray(e[r])&&e[r]!==null?te(s[r],e[r],t):s[r]=e[r]})},ne=[String,Number,Boolean,Symbol,Array,Object],J=s=>{let e=[];const i=s(l=>{e.push(l)});return{promise:new Promise((l,r)=>{i.then(n=>{e=[],l(n)},n=>{e=[],r(n)})}),dispose:()=>{e.forEach(l=>l()),e=[]}}},O=(s,e)=>{let t=null,i=null,a=[];return async(...r)=>(t==null||t(),a.push(new Promise((n,o)=>{let u=null;const h=setTimeout(()=>{const f=s(...r);"promise"in f?(f.promise.then(n,o),u=()=>{var _;(_=f.dispose)==null||_.call(f)}):f.then(n,o)},e);t=()=>{u==null||u(),u=null,clearTimeout(h),o()}})),i||(i=(async()=>{for(;a.length;){const n=a.shift();try{const o=await n;if(!a.length)return o}catch(o){if(!a.length)throw o}}})(),i.finally(()=>{t=null,i=null,a=[]})))},oe=(s,e,t)=>J(async i=>{if(s.required&&!e&&e!==0||s.requiredLength&&(typeof(e==null?void 0:e.length)!="number"||e.length<=0))return"{{name}} is required";if(s.minLength!==void 0&&(typeof(e==null?void 0:e.length)!="number"||e.length<s.minLength))return`{{name}}'s length cannot be less than ${s.minLength}`;if(s.maxLength!==void 0&&(typeof(e==null?void 0:e.length)!="number"||e.length>s.maxLength))return`{{name}}'s length cannot be greater than ${s.maxLength}`;if(s.min!==void 0&&(typeof e!="number"||e<s.min))return`{{name}} cannot be less than ${s.min}`;if(s.max!==void 0&&(typeof e!="number"||e>s.max))return`{{name}} cannot be greater than ${s.max}`;if(s.pattern&&(typeof e!="string"&&typeof e!="number"||!s.pattern.test(`${e}`)))return`{{name}} not match ${s.pattern.toString()}`;const a=Object.keys(z);for(const l of a)if(s[l]===!0){const r=z[l],n=r(e,t);typeof n=="object"&&"dispose"in n&&typeof n.dispose=="function"&&i(()=>{var u;return(u=n.dispose)==null?void 0:u.call(n)});const o=typeof n=="object"&&"promise"in n?await n.promise:await n;if(o)return o}if(s.validator){const l=s.validator(e,t);typeof l=="object"&&"dispose"in l&&typeof l.dispose=="function"&&i(()=>{var n;return(n=l.dispose)==null?void 0:n.call(l)});const r=typeof l=="object"&&"promise"in l?await l.promise:await l;if(r)return r}return""});class Re{constructor(e,t){this.rules=I([]),this.deps=null,this.validateDispose=null,this.debounce=0,this.transform=null,this.isEqual=null,this.focusFn=null,this.stopValidateWatcher=null,this.stopDirtyWatcher=null,this.isRegistered=!1,this.isInited=!1,this.runInAction=l=>{l()};const{immediate:i=!0}=t;this.form=e,this.name=t.name,this.setRules(t.rules||[]),this.deps=t.deps||null,this.transform=t.transform||null,this.isEqual=t.isEqual||null,this.focusFn=t.onFocus||null,this.debounce=t.debounce||0,this.initValue=t.initValue,this.initDefaultValue=t.initDefaultValue,this.state=G({error:null,isError:!1,isValidating:!1,isDirty:!1,isTouched:!1,isChanged:!1});const a=(l,r,n)=>{const o=this.transform;let u=!1;return J(async h=>{h(()=>{u=!0});for(const f of n){const _=oe(f,o&&l!==void 0?o(l):l,r);h(()=>{var D;return(D=_.dispose)==null?void 0:D.call(_)});const g=await _.promise;if(u)return null;let $=null;if(g)return $=typeof g=="string"?{type:f.type,message:g}:g,$.message=$.message.replace(/\{\{name\}\}/g,this.name),f.message!==void 0&&($.message=f.message.replace(/\{\{name\}\}/g,this.name)),$}return null})};this.validate=a,i&&this.onRegister()}getValue(){return y(this.form.state.values,this.name)}getDefaultValue(){return y(this.form.state.defaultValues,this.name)}setRules(e=[]){this.rules.value=e.map(t=>t.debounce?{validator:O((a,l)=>oe(t,a,l),t.debounce)}:t)}update(e={}){e.rules&&this.setRules(e.rules)}initWatcher(){if(this.isInited)return;const e=async i=>{var a;(a=this.validateDispose)==null||a.call(this),this.validateDispose=null;const{value:l,deps:r,rules:n}=i;let o=!1;const u=this.validate(l,r,n);this.validateDispose=()=>{var f;(f=u.dispose)==null||f.call(u),o=!0,this.validateDispose=null};const h=await u.promise;o||(this.runInAction(()=>{this.state.isValidating=!1;const f=!!(h!=null&&h.message);f?(this.state.error||(this.state.error={message:""}),this.state.error.message=(h==null?void 0:h.message)||"",this.state.error.type=h==null?void 0:h.type):this.state.error=null,this.state.isError=f}),this.validateDispose=null)},t=this.debounce?O(e,this.debounce):e;this.stopValidateWatcher=B(()=>{var i;this.runInAction(()=>{this.state.isValidating=!0});const a=this.getValue(),l=(i=this.deps)==null?void 0:i.call(this),r=this.rules.value;Promise.resolve().then(()=>{t({value:a,deps:l,rules:r})})}),this.stopDirtyWatcher=B(()=>{const i=this.getValue(),a=this.getDefaultValue();this.runInAction(()=>{const l=this.isEqual||((r,n)=>r===n);this.state.isDirty=!l(b(i),b(a))})}),this.isInited=!0}onRegister(){this.isRegistered||(this.initWatcher(),this.isRegistered=!0)}onUnregister(){var e,t,i;(e=this.validateDispose)==null||e.call(this),this.validateDispose=null,(t=this.stopValidateWatcher)==null||t.call(this),(i=this.stopDirtyWatcher)==null||i.call(this),this.isRegistered=!1,this.isInited=!1}onTouched(e=!0){this.runInAction(()=>{this.state.isTouched=e})}onChanged(e=!0){this.state.isChanged=e}onFocus(){var e;(e=this.focusFn)==null||e.call(this)}reset(e={}){var t,i,a;(t=this.validateDispose)==null||t.call(this),this.validateDispose=null,(i=this.stopValidateWatcher)==null||i.call(this),(a=this.stopDirtyWatcher)==null||a.call(this),this.runInAction(()=>{const{keepChanged:l=!1,keepTouched:r=!1}=e;this.state.error=null,this.state.isError=!1,this.state.isValidating=!1,this.state.isDirty=!1,this.state.isTouched=r?this.state.isTouched:!1,this.state.isChanged=l?this.state.isChanged:!1}),this.isInited=!1,this.initWatcher()}}const ue=(s,e)=>J(async t=>{if(s.required&&!e&&e!==0||s.requiredLength&&(typeof(e==null?void 0:e.length)!="number"||e.length<=0))return"{{name}} is required";if(s.minLength!==void 0&&(typeof(e==null?void 0:e.length)!="number"||e.length<s.minLength))return`{{name}}'s length cannot be less than ${s.minLength}`;if(s.maxLength!==void 0&&(typeof(e==null?void 0:e.length)!="number"||e.length>s.maxLength))return`{{name}}'s length cannot be greater than ${s.maxLength}`;if(s.min!==void 0&&(typeof e!="number"||e<s.min))return`{{name}} cannot be less than ${s.min}`;if(s.max!==void 0&&(typeof e!="number"||e>s.max))return`{{name}} cannot be greater than ${s.max}`;if(s.pattern&&(typeof e!="string"&&typeof e!="number"||!s.pattern.test(`${e}`)))return`{{name}} not match ${s.pattern.toString()}`;const i=Object.keys(z);for(const a of i)if(s[a]===!0){const l=z[a],r=l(e);typeof r=="object"&&"dispose"in r&&typeof r.dispose=="function"&&t(()=>{var o;return(o=r.dispose)==null?void 0:o.call(r)});const n=typeof r=="object"&&"promise"in r?await r.promise:await r;if(n)return n}if(s.validator){const a=s.validator(e);typeof a=="object"&&"dispose"in a&&typeof a.dispose=="function"&&t(()=>{var r;return(r=a.dispose)==null?void 0:r.call(a)});const l=typeof a=="object"&&"promise"in a?await a.promise:await a;if(l)return l}return""});class Pe{constructor(e,t){this.name="",this.rules=I([]),this.validateDispose=null,this.debounce=0,this.stopValidateWatcher=null,this.isRegistered=!1,this.isInited=!1,this.runInAction=l=>{l()};const{immediate:i=!0}=t;this.form=e,this.name=t.name,this.value=t.value,this.setRules(t.rules||[]),this.debounce=t.debounce||0,this.state=G({name:this.name,error:null,isError:!1,isValidating:!1});const a=(l,r)=>{let n=!1;return J(async o=>{o(()=>{n=!0});for(const u of r){const h=ue(u,l);o(()=>{var g;return(g=h.dispose)==null?void 0:g.call(h)});const f=await h.promise;if(n)return null;let _=null;if(f)return _=typeof f=="string"?{type:u.type,message:f}:f,_.message=_.message.replace(/\{\{name\}\}/g,this.name),u.message!==void 0&&(_.message=u.message.replace(/\{\{name\}\}/g,this.name)),_}return null})};this.validate=a,i&&this.initWatcher()}setRules(e=[]){this.rules.value=e.map(t=>t.debounce?{validator:O(a=>ue(t,a),t.debounce)}:t)}update(e){e.rules&&this.setRules(e.rules),e.value&&(this.value=e.value)}initWatcher(){var e;if(this.isInited)return;(e=this.validateDispose)==null||e.call(this),this.validateDispose=null;const t=async a=>{this.runInAction(()=>{this.state.isValidating=!0});const{value:l,rules:r}=a;let n=!1;const o=this.validate(l,r);this.validateDispose=()=>{var h;(h=o.dispose)==null||h.call(o),n=!0,this.validateDispose=null};const u=await o.promise;n||(this.runInAction(()=>{this.state.isValidating=!1;const h=!!(u!=null&&u.message);h?(this.state.error||(this.state.error={message:""}),this.state.error.message=(u==null?void 0:u.message)||"",this.state.error.type=u==null?void 0:u.type):this.state.error=null,this.state.isError=h}),this.validateDispose=null)},i=this.debounce?O(t,this.debounce):t;this.stopValidateWatcher=B(()=>{const a=this.value(),l=this.rules.value;Promise.resolve().then(()=>{i({value:a,rules:l})})}),this.isInited=!0}onRegister(){this.isRegistered||(this.initWatcher(),this.isRegistered=!0)}onUnregister(){var e,t;(e=this.validateDispose)==null||e.call(this),this.validateDispose=null,(t=this.stopValidateWatcher)==null||t.call(this),this.isRegistered=!1,this.isInited=!1}}class Le{constructor(e){this.touchType="BLUR",this._publicState=null,this.fieldsKeys=I([]),this.fields=new Map,this.virtualFieldsKeys=I([]),this.virtualFields=new Map,this.cacheFields=[],this.cacheVirtualFields=[],this.stopStateWatcher=null,this.stopStatusWatcher=null,this.stopValidatingWatcher=null,this.waiters=[],this.subscribers=[],this.isMounted=!1,this.readonly=!1,this.submitFlag=0,this.runInAction=i=>{i()};const{initValues:t={}}=e;this.initValues=b(t),this.defaultValues=b(e.defaultValues||e.initValues),this._state=G({values:t,defaultValues:e.defaultValues||t,fieldErrors:{},virtualErrors:{},error:null,fieldError:null,virtualError:null,isError:!1,isFieldError:!1,isVirtualError:!1,isValidating:!1,isFieldValidating:!1,isVirtualValidating:!1,isDirty:!1,isTouched:!1,isChanged:!1,isSubmitted:!1,isSubmitting:!1,submitCount:0}),this.touchType=e.touchType||"BLUR",this.readonly=e.readonly||!1}get state(){return this.readonly?(this._publicState||(this._publicState=ge(this._state)),this._publicState):this._state}mount(){if(this.isMounted)return;const{cacheFields:e,cacheVirtualFields:t}=this;for(const i of e){const a=this.fields.get(i);a.initWatcher(),a.initDefaultValue!==void 0&&T(this._state.defaultValues,i,a.initDefaultValue),a.initValue!==void 0&&T(this._state.values,i,a.initValue)}for(const i of t){const a=this.virtualFields.get(i);a==null||a.initWatcher()}this.cacheFields=[],this.cacheVirtualFields=[],this.fieldsKeys.value.push(...e),this.virtualFieldsKeys.value.push(...t),this.stopStateWatcher=B(()=>{const i=this.fieldsKeys.value,a=this.virtualFieldsKeys.value;let l=!1,r=!1,n=!1,o=!1,u=!1,h=!1,f=!1,_=null,g=null;const $={},D={};i.forEach(R=>{const x=this.fields.get(R);if(!x)return;const m=x.state.error,v=x.state.isError,p=x.state.isValidating,V=x.state.isDirty,F=x.state.isTouched,W=x.state.isChanged;T($,R,m),v&&(l=!0),p&&(n=!0),V&&(u=!0),F&&(h=!0),W&&(f=!0),m&&!_&&(_=m)}),a.forEach(R=>{const x=this.virtualFields.get(R);if(!x)return;const m=x.state.error,v=x.state.isError,p=x.state.isValidating;T(D,R,m),v&&(r=!0),p&&(o=!0),m&&!g&&(g=m)}),this.runInAction(()=>{te(this._state.fieldErrors,$),te(this._state.virtualErrors,D),this._state.isFieldError=l,this._state.isVirtualError=r,this._state.isError=l||r,this._state.fieldError=_,this._state.virtualError=g,this._state.error=_||g,this._state.isFieldValidating=n,this._state.isVirtualValidating=o,this._state.isValidating=n||o,this._state.isDirty=u,this._state.isTouched=h,this._state.isChanged=f})}),this.stopValidatingWatcher=B(()=>{this._state.isValidating||this.waiters.forEach(a=>{a()}),this.waiters=[]}),this.isMounted=!0}unmount(){var e,t,i;(e=this.stopStateWatcher)==null||e.call(this),(t=this.stopStatusWatcher)==null||t.call(this),(i=this.stopValidatingWatcher)==null||i.call(this);const a=[...this.fieldsKeys.value];for(const r of a)this.unregisterField(r);const l=[...this.virtualFieldsKeys.value];for(const r of l)this.unregisterVirtualField(r);for(const r of this.cacheFields)this.unregisterField(r);for(const r of this.cacheVirtualFields)this.unregisterVirtualField(r);this.subscribers=[],this.reset({values:b(this.initValues),defaultValues:b(this.defaultValues)}),this.isMounted=!1}registerField(e,t={}){const{immediate:i=!0,value:a=y(this.initValues,e),defaultValue:l=y(this.defaultValues||{},e)}=t,{fieldsKeys:r,fields:n,cacheFields:o}=this;if(r.value.includes(e)||o.includes(e))return console.warn(`Duplicate field <${e}>.`),{field:this.fields.get(e),register:()=>{}};for(const f of[...r.value,...o])if(f.startsWith(`${e}.`)||e.startsWith(`${f}.`))return console.warn(`Fields can not be nested together: <${e}> <${f}>. If you want do this, please use [registerVirtualField]`),{field:this.fields.get(e),register:()=>{}};const u=new Re(this,{...t,name:e,initValue:a,initDefaultValue:l});n.set(e,u);const h=()=>{this.runInAction(()=>{this.isMounted?(l!==void 0&&T(this._state.defaultValues,e,l),a!==void 0&&T(this._state.values,e,l),this.fieldsKeys.value.push(e),u.initWatcher()):this.cacheFields.push(e)})};return i?(h(),{field:u,register:()=>{}}):{register:h,field:u}}registerVirtualField(e,t){const{immediate:i=!0}=t,{virtualFieldsKeys:a,virtualFields:l,cacheVirtualFields:r}=this;if(a.value.includes(e)||r.includes(e))return console.warn(`Duplicate virtual field <${e}>.`),{field:this.virtualFields.get(e),register:()=>{}};const n=new Pe(this,{...t,name:e});l.set(e,n);const o=()=>{this.runInAction(()=>{this.isMounted?(this.virtualFieldsKeys.value.push(e),n.initWatcher()):this.cacheVirtualFields.push(e)})};return i?(o(),{field:n,register:()=>{}}):{register:o,field:n}}unregisterField(e,t={}){const{removeValue:i=!1}=t,{fields:a}=this,l=a.get(e);if(!!l){if(l.onUnregister(),this.isMounted){const r=this.fieldsKeys.value.indexOf(e);r!==-1&&this.fieldsKeys.value.splice(r,1)}else{const r=this.cacheFields.indexOf(e);r!==-1&&this.cacheFields.splice(r,1)}this.runInAction(()=>{i&&U(this._state.values,e),i&&U(this._state.defaultValues,e),U(this._state.fieldErrors,e)}),a.delete(e)}}unregisterVirtualField(e){const{virtualFields:t}=this,i=t.get(e);if(!!i){if(i.onUnregister(),this.isMounted){const a=this.virtualFieldsKeys.value.indexOf(e);a!==-1&&this.virtualFieldsKeys.value.splice(a,1)}else{const a=this.cacheVirtualFields.indexOf(e);a!==-1&&this.cacheVirtualFields.splice(a,1)}this.runInAction(()=>{U(this._state.virtualErrors,e)}),t.delete(e)}}setPathValue(e,t){T(this._state.values,e,t),this.notify("UPDATE",e)}setValue(e,t){const i=this.fields.get(e);if(!i){console.warn(`Field not exists <${e}>.`);return}const l=b(y(this._state.values,e))!==b(t);this.setPathValue(e,t),i.onChanged(i.state.isChanged||l)}deletePathValue(e){U(this._state.values,e),this.notify("DELETE",e)}deleteValue(e){if(!this.fields.get(e)){console.warn(`Field not exists <${e}>.`);return}this.deletePathValue(e)}getPathValueRef(e){return Y(()=>y(this.state.values,e))}getValueRef(e){return Y(()=>{if(!this.fieldsKeys.value.includes(e)){console.warn(`Field not exists <${e}>.`);return}return y(this.state.values,e)})}getPathValue(e){return y(this.state.values,e)}getValue(e){if(!this.fieldsKeys.value.includes(e)){console.warn(`Field not exists <${e}>.`);return}return y(this.state.values,e)}setTouched(e,t=!0){const i=this.fields.get(e);if(!i){console.warn(`Field not exists <${e}>.`);return}i.onTouched(t)}setFocus(e){const t=this.fields.get(e);if(!t){console.warn(`Field not exists <${e}>.`);return}t.onFocus()}submit(e={}){const t=this.submitFlag,i=()=>{var a,l;if(t===this.submitFlag){if(this.runInAction(()=>{this._state.isSubmitting=!1}),this._state.isError){(a=e.onError)==null||a.call(e,b(this._state.error));return}this.runInAction(()=>{this._state.isSubmitted=!0}),(l=e.onSuccess)==null||l.call(e,b(this._state.values))}};this.runInAction(()=>{this._state.submitCount++,this._state.isSubmitting=!0}),this._state.isValidating?this.waiters.push(()=>{i()}):i()}reset(e={}){this.waiters=[],this.runInAction(()=>{e.values?(this._state.values=b(e.values),this.initValues=b(e.values)):e.keepValues||(this._state.values=this.initValues),e.defaultValues?(this._state.defaultValues=b(e.defaultValues),this.defaultValues=e.defaultValues):e.keepDefaultValues||(this._state.defaultValues=this.initValues||this.defaultValues),this.submitFlag++,this._state.isSubmitting=!1,this._state.submitCount=e.keepSubmitCount?this._state.submitCount:0,this._state.isSubmitted=e.keepIsSubmitted?this._state.isSubmitted:!1});for(const[,t]of this.fields)t.reset({keepTouched:e.keepTouched,keepChanged:e.keepChanged});this.notify("RESET")}resetField(e,t={}){const i=this.fields.get(e);if(!i){console.warn(`Field not exists <${e}>.`);return}if("defaultValue"in t&&T(this._state.defaultValues,e,b(t.defaultValue)),"value"in t)T(this._state.values,e,b(t.value));else if(!t.keepValue){const a=y(this._state.defaultValues,e);T(this._state.values,e,b(a))}i.reset({keepTouched:t.keepTouched,keepChanged:t.keepChanged})}subscribe(e){return this.subscribers.push(e),()=>{const i=this.subscribers.indexOf(e);i!==-1&&this.subscribers.splice(i,1)}}notify(e,t){this.subscribers.forEach(i=>{i(e,t)})}fieldState(e){if(!this.fieldsKeys.value.includes(e))return null;const t=this.fields.get(e);return t?t.state:null}virtualFieldState(e){if(!this.virtualFieldsKeys.value.includes(e))return null;const t=this.virtualFields.get(e);return t?t.state:null}isDirty(e){var t;return((t=this.fieldState(e))==null?void 0:t.isDirty)||!1}isTouched(e){var t;return((t=this.fieldState(e))==null?void 0:t.isTouched)||!1}isChanged(e){var t;return((t=this.fieldState(e))==null?void 0:t.isChanged)||!1}isValidating(e){var t;return((t=this.fieldState(e))==null?void 0:t.isValidating)||!1}isVirtualValidating(e){var t;return((t=this.virtualFieldState(e))==null?void 0:t.isValidating)||!1}isError(e){var t;return((t=this.fieldState(e))==null?void 0:t.isError)||!1}isVirtualError(e){var t;return((t=this.virtualFieldState(e))==null?void 0:t.isError)||!1}fieldError(e,t="anyTouched"){var i;const a=this.state.submitCount>0,l=this.isTouched(e);return t==="allTouched"&&(!a||!l)||t==="formTouched"&&!a||t==="fieldTouched"&&!l||t==="anyTouched"&&!l&&!a?null:((i=this.fieldState(e))==null?void 0:i.error)||null}virtualFieldError(e,t="formTouched"){var i;const a=this.state.submitCount>0;return t==="formTouched"&&!a?null:((i=this.virtualFieldState(e))==null?void 0:i.error)||null}arrayAppend(e,t){const i=y(this._state.values,e);!Array.isArray(i)||(i.push(t),this.notify("UPDATE",e))}arrayPrepend(e,t){const i=y(this._state.values,e);!Array.isArray(i)||(i.unshift(t),this.notify("UPDATE",e))}arrayInsert(e,t,i){const a=y(this._state.values,e);!Array.isArray(a)||(a.splice(t,0,i),this.notify("UPDATE",e))}arraySwap(e,t,i){const a=y(this._state.values,e);if(!Array.isArray(a))return;const l=a[i];a[i]=a[t],a[t]=l,this.notify("UPDATE",e)}arrayMove(e,t,i){const a=y(this._state.values,e);!Array.isArray(a)||(a.splice(i,0,a[t]),a.splice(i>t?t:t+1),this.notify("UPDATE",e))}arrayUpdate(e,t,i){const a=y(this._state.values,e);!Array.isArray(a)||(a.splice(t,1,i),this.notify("UPDATE",e))}arrayRemove(e,t){const i=y(this._state.values,e);!Array.isArray(i)||(i.splice(t,1),this.notify("UPDATE",e))}arrayReplace(e,t){const i=y(this._state.values,e);!Array.isArray(i)||(T(this._state.values,e,t),this.notify("UPDATE",e))}}const We=s=>new Le(s),ve=Symbol(),q=s=>Ve(ve,null),qe=s=>{const e=q(),{form:t=e,name:i}=s;if(!t)throw new Error("No provided form!");const a=Y(()=>s.touchType?c(s.touchType):t.touchType||"BLUR"),l=I(!1),r=I(null),n=v=>r.value=v,o=v=>{var p,V;const F=typeof v=="object"&&typeof v.currentTarget=="object"&&((p=v.currentTarget)==null?void 0:p.value)!==void 0?(V=v.currentTarget)==null?void 0:V.value:v;t.setValue(c(i),F)},u=()=>{!l.value||a.value==="BLUR"&&t.setTouched(c(i),!0)},h=()=>{!l.value||a.value==="FOCUS"&&t.setTouched(c(i),!0)};let{register:f,field:_}=t.registerField(c(i),{rules:c(s.rules),transform:s.transform,deps:s.deps,immediate:!1,onFocus:()=>{var v,p;(p=(v=r.value)==null?void 0:v.focus)==null||p.call(v)},debounce:s.debounce,value:s.value,defaultValue:s.defaultValue});const g=I(y(t.state.values,c(s.name))),$=I(_.state),D=K(()=>[c(s.name),c(s.rules)],([v,p],[V])=>{t.unregisterField(V);const F=t.registerField(v,{rules:p,transform:s.transform,deps:s.deps,isEqual:s.isEqual,immediate:l.value,onFocus:()=>{var W,M;(M=(W=r.value)==null?void 0:W.focus)==null||M.call(W)},debounce:s.debounce,value:s.value,defaultValue:s.defaultValue});f=F.register,_=F.field,$.value=F.field.state,g.value=y(t.state.values,c(s.name))}),R=K(()=>y(t.state.values,c(s.name)),v=>{g.value=v}),x=K(()=>g.value,v=>{const p=y(t.state.values,c(s.name));b(p)!==b(v)&&(g.value=v)});return ie(()=>{f==null||f(),l.value=!0}),se(()=>{l.value=!1,t.unregisterField(c(i)),D(),R(),x(),r.value=null}),[G({get value(){return g.value},onInput:o,onChange:o,onBlur:u,onFocus:h,ref:n}),g,{mounted:l}]},Ue=s=>{const e=q(),{form:t=e,name:i}=s;if(!t)throw new Error("No provided form!");const a=I(!1);let{register:l,field:r}=t.registerVirtualField(c(i),{value:s.value,rules:c(s.rules),immediate:!1,debounce:s.debounce});const n=I(r.state),o=K(()=>c(s.name),(u,h)=>{t.unregisterVirtualField(h);const f=t.registerVirtualField(c(i),{value:s.value,rules:c(s.rules),immediate:a.value,debounce:s.debounce});l=f.register,r=f.field,n.value=f.field.state});return ie(()=>{l(),a.value=!0}),se(()=>{t.unregisterVirtualField(c(i)),o()}),{mounted:a}},Ke=(s,e)=>{let t=0,i=s.getPathValue(e);Array.isArray(i)||(s.setPathValue(e,[]),i=s.getPathValue(e));const l=i.map(m=>({id:`${t++}`,name:`${e}.${m}`}));let r=l.map(m=>m.id);const n=I(l),o={},u=K(()=>s.getPathValue(e).map(v=>b(v)),(m,v)=>{const p=[...v],V=m.map((F,W)=>{const M=b(F),Q=p.findIndex(_e=>b(_e)===M);let X="";return Q===-1?X=`${t++}`:(X=r[Q],p[Q]=o),{id:`${X}`,name:`${e}.${W}`}});n.value=V,r=V.map(F=>F.id)});return{onCleanup:()=>{u()},get fieldsValue(){return n.value},fields:n,prepend:m=>{s.arrayPrepend(e,m)},append:m=>{s.arrayAppend(e,m)},insert:(m,v)=>{const p=n.value.findIndex(V=>V.id===m);p!==-1&&s.arrayInsert(e,p,v)},swap:(m,v)=>{const p=n.value.findIndex(F=>F.id===m),V=n.value.findIndex(F=>F.id===v);p===-1||V===-1||s.arraySwap(e,p,V)},move:(m,v)=>{const p=n.value.findIndex(F=>F.id===m),V=n.value.findIndex(F=>F.id===v);p===-1||V===-1||p===V||s.arrayMove(e,p,V)},replace:m=>{r=[],s.arrayReplace(e,m)},remove:m=>{const v=n.value.findIndex(p=>p.id===m);v!==-1&&s.arrayRemove(e,v)},update:(m,v)=>{const p=n.value.findIndex(V=>V.id===m);p!==-1&&s.arrayUpdate(e,p,v)}}},me=s=>{const e=q(),{form:t=e,path:i}=s;if(!t)throw new Error("No provided form!");const{onCleanup:a,...l}=Ke(t,i);return se(()=>a()),l},Be=s=>{ye(ve,s),ie(()=>s.mount()),be(()=>s.unmount())},Ne=L({__name:"VirtualField",props:{form:{type:Object,default:void 0},name:{type:String,required:!0},value:{type:Function,required:!0},rules:{type:Array,default:()=>[]},debounce:{type:Number,default:void 0}},setup(s){const e=s,{name:t,form:i,value:a,rules:l,debounce:r}=de(e),{mounted:n}=Ue({form:i==null?void 0:i.value,rules:l.value,value:a.value,debounce:r==null?void 0:r.value,name:t});return(o,u)=>c(n)?Z(o.$slots,"default",{key:0}):H("",!0)}}),je=L({__name:"FieldArray",props:{form:{type:Object,default:void 0},name:{type:String,required:!0}},setup(s){const e=s,{fieldsValue:t,fields:i,...a}=me({form:e.form,path:e.name});return(l,r)=>Z(l.$slots,"default",k(a,{fields:c(i)}))}}),Me=L({__name:"FormProvider",props:{form:{type:Object,required:!0}},setup(s){return Be(s.form),(t,i)=>Z(t.$slots,"default")}}),ze=()=>({form:{type:Object,default:void 0},name:{type:String,required:!0},rules:{type:Array,default:()=>[]},deps:{type:Function,default:void 0},debounce:{type:Number,default:void 0},value:{type:ne,default:void 0},defaultValue:{type:ne,default:void 0},transform:{type:Function,default:void 0},touchType:{type:String,default:"BLUR"},changeType:{type:String,default:"ONCHANGE"},isEqual:{type:Function,default:void 0}}),Oe=L({__name:"index",props:ze(),setup(s){const e=s,{form:t,rules:i,transform:a,name:l,deps:r,debounce:n,changeType:o,value:u,defaultValue:h,isEqual:f,..._}=de(e),[g,,{mounted:$}]=qe({form:t==null?void 0:t.value,rules:i.value,transform:a==null?void 0:a.value,deps:r==null?void 0:r.value,debounce:n==null?void 0:n.value,name:l,changeType:o.value,value:u==null?void 0:u.value,defaultValue:h==null?void 0:h.value,isEqual:f==null?void 0:f.value,..._});return(D,R)=>c($)?Z(D.$slots,"default",{key:0,field:c(g)}):H("",!0)}}),P=Oe,Ze=Ne,Ge=je,He=Me,Je=()=>We({initValues:{username:"",password:"",passwordConfirm:"",baseInfo:{birthDay:"",age:""},tags:[],address:[],schools:[]},touchType:"BLUR",readonly:!1}),Qe=d("div",{class:"vfm-block-title"},"Base Info",-1),Xe={class:"vfm-p"},Ye=d("div",{class:"vfm-label"}," Birth Day: ",-1),et={class:"vfm-value"},tt={class:"vfm-error"},st={class:"vfm-p"},it=d("div",{class:"vfm-label"}," Age: ",-1),at={class:"vfm-value"},lt={class:"vfm-error"},rt=L({__name:"BaseInfo",setup(s){const e=q();return e.state,(t,i)=>{var a,l;return A(),S(N,null,[Qe,d("div",Xe,[Ye,d("div",et,[E(c(P),{form:c(e),name:"baseInfo.birthDay",rules:[{required:!0}],value:"1988"},{default:C(({field:r})=>[d("input",k({class:"vfm-input",type:"text"},r),null,16)]),_:1},8,["form"]),d("div",tt,w((a=c(e).fieldError("baseInfo.birthDay"))==null?void 0:a.message),1)])]),d("div",st,[it,d("div",at,[E(c(P),{form:c(e),name:"baseInfo.age",rules:[{required:!0}]},{default:C(({field:r})=>[d("input",k({class:"vfm-input",type:"text"},r),null,16)]),_:1},8,["form"]),d("div",lt,w((l=c(e).fieldError("baseInfo.age"))==null?void 0:l.message),1)])])],64)}}}),nt=j(rt,[["__file","BaseInfo.vue"]]),le=s=>(ce("data-v-162246d7"),s=s(),fe(),s),ot=le(()=>d("div",{class:"vfm-block-title"},"Address",-1)),ut={class:"vfm-p"},dt=le(()=>d("div",{class:"vfm-label"}," Phone: ",-1)),ct={class:"vfm-value"},ft={class:"vfm-error"},ht={class:"vfm-p"},vt=le(()=>d("div",{class:"vfm-label"}," Detail: ",-1)),mt={class:"vfm-value"},pt={class:"vfm-error"},_t={class:"vfm-p"},gt=["onClick"],yt={class:"vfm-p"},bt=L({__name:"AddressList",setup(s){const e=q(),{fields:t,append:i,remove:a}=me({form:e,path:"address"}),l=()=>{i({phone:"",detail:""})},r=n=>{a(n)};return(n,o)=>(A(),S(N,null,[ot,(A(!0),S(N,null,ae(c(t),(u,h)=>{var f,_;return A(),S("div",{class:"block",key:u.id},[d("div",ut,[dt,d("div",ct,[E(c(P),{form:c(e),name:`address.${h}.phone`,rules:[{required:!0}]},{default:C(({field:g})=>[d("input",k({class:"vfm-input",type:"text"},g),null,16)]),_:2},1032,["form","name"]),d("div",ft,w((f=c(e).fieldError(`address.${h}.phone`))==null?void 0:f.message),1)])]),d("div",ht,[vt,d("div",mt,[E(c(P),{form:c(e),name:`address.${h}.detail`,rules:[{required:!0}]},{default:C(({field:g})=>[d("input",k({class:"vfm-input",type:"text"},g),null,16)]),_:2},1032,["form","name"]),d("div",pt,w((_=c(e).fieldError(`address.${h}.detail`))==null?void 0:_.message),1)])]),d("div",_t,[d("div",{class:"vfm-action red",onClick:()=>r(u.id)},"- delete",8,gt)])])}),128)),d("div",yt,[d("div",{class:"vfm-action",onClick:o[0]||(o[0]=()=>l())},"+ Add Address")])],64))}});const Vt=j(bt,[["__scopeId","data-v-162246d7"],["__file","AddressList.vue"]]),Ft={class:"sbox"},$t=["onUpdate:modelValue"],xt=L({__name:"SelectSchool",props:{visible:{type:Boolean,default:!1},value:{type:Array,default:()=>[]}},emits:["change","update:visible"],setup(s,{emit:e}){const t=s,a=I([{name:"School A",address:"School Address A"},{name:"School B",address:"School Address B"},{name:"School C",address:"School Address C"},{name:"School D",address:"School Address D"},{name:"School E",address:"School Address E"}].map(n=>{const o=t.value.find(u=>u.name===n.name);return{...n,selected:!!o}})),l=()=>{e("update:visible",!1)},r=()=>{const n=a.value.filter(o=>o.selected).map(o=>({name:o.name,address:o.address}));e("change",n),e("update:visible",!1)};return(n,o)=>(A(),S("div",Ft,[(A(!0),S(N,null,ae(a.value,u=>(A(),S("div",{class:"item",key:u.name},[d("label",null,[ee(d("input",{type:"checkbox","onUpdate:modelValue":h=>u.selected=h},null,8,$t),[[Fe,u.selected]]),d("span",null,w(u.name)+" <"+w(u.address)+">",1)])]))),128)),d("div",{class:"btns"},[d("button",{onClick:l},"close"),d("button",{onClick:r},"confirm")])]))}});const At=j(xt,[["__scopeId","data-v-904e1e4f"],["__file","SelectSchool.vue"]]),pe=s=>(ce("data-v-968ee466"),s=s(),fe(),s),Et={class:"box"},St=pe(()=>d("div",{class:"vfm-block-title"},"Schools",-1)),wt={class:"vfm-p"},It=pe(()=>d("div",{class:"vfm-label"}," Selected Schools: ",-1)),Tt={class:"vfm-value"},Ct=L({__name:"SchoolList",setup(s){const e=q(),t=e.getPathValueRef("schools"),i=I(!1),a=()=>{i.value=!0};return(l,r)=>(A(),S("div",Et,[E(c(P),{form:c(e),name:"schools",rules:[{requiredLength:!0,message:"Must select one school"}]},{default:C(({field:n})=>{var o;return[St,d("div",wt,[It,d("div",Tt,[ee(d("div",{class:"vfm-input",onClick:a},w(c(t).map(u=>u.name).join(",")),513),[[re,!i.value]]),ee(d("div",{class:"vfm-error"},w((o=c(e).fieldError("schools"))==null?void 0:o.message),513),[[re,!i.value]]),i.value?(A(),he(At,k({key:0},n,{visible:i.value,"onUpdate:visible":r[0]||(r[0]=u=>i.value=u)}),null,16,["visible"])):H("",!0)])])]}),_:1},8,["form"])]))}});const Dt=j(Ct,[["__scopeId","data-v-968ee466"],["__file","SchoolList.vue"]]),kt={class:"vfm"},Rt={class:"vfm-p"},Pt=d("div",{class:"vfm-label"},"User Name:",-1),Lt={class:"vfm-value"},Wt={key:0,class:"vfm-error"},qt={key:1,class:"vfm-error"},Ut={class:"vfm-p"},Kt=d("div",{class:"vfm-label"},"Password:",-1),Bt={class:"vfm-value"},Nt={class:"vfm-error"},jt={class:"vfm-p"},Mt=d("div",{class:"vfm-label"},"Password Confirm:",-1),zt={class:"vfm-value"},Ot={class:"vfm-error"},Zt={class:"vfm-p"},Gt=d("div",{class:"vfm-label"},"Tags:",-1),Ht={class:"vfm-value"},Jt={class:"vfm-flex"},Qt={class:"vfm-flex-item-box"},Xt={class:"vfm-flex-item-ins"},Yt=["onClick"],es={class:"vfm-error"},ts=["onClick"],ss={class:"vfm-p"},is=d("div",{class:"vfm-label"},"Virtual Field (Tags):",-1),as={class:"vfm-error"},ls={class:"vfm-p"},rs={key:0,class:"vfm-error",style:{width:"100%",textAlign:"center"}},ns=L({__name:"BaseForm",setup(s){const e=Je(),t=e.state,i=()=>{e.submit({onSuccess:l=>{alert(JSON.stringify(l,null,2))},onError:l=>{alert(l.message)}})},a=l=>(console.log("checkName"),new Promise(r=>{setTimeout(()=>{if(l==="test"){r("Username already exists");return}r("")},1e3)}));return(l,r)=>(A(),he(c(He),{form:c(e)},{default:C(()=>{var n;return[d("div",kt,[d("div",Rt,[Pt,d("div",Lt,[E(c(P),{form:c(e),name:"username",rules:[{required:!0},{validator:o=>a(o),debounce:300}],"change-type":"ONINPUT"},{default:C(({field:o})=>{var u;return[d("input",k({class:"vfm-input",type:"text"},o),null,16),c(e).isValidating("username")?(A(),S("div",Wt," loading... ")):(A(),S("div",qt,w((u=c(e).fieldError("username"))==null?void 0:u.message),1))]}),_:1},8,["form","rules"])])]),d("div",Ut,[Kt,d("div",Bt,[E(c(P),{form:c(e),name:"password",rules:[{required:!0,pattern:/[a-zA-Z0-9]{8,20}/}]},{default:C(({field:o})=>{var u;return[d("input",k({class:"vfm-input",type:"password"},o),null,16),d("div",Nt,w((u=c(e).fieldError("password"))==null?void 0:u.message),1)]}),_:1},8,["form"])])]),d("div",jt,[Mt,d("div",zt,[E(c(P),{form:c(e),name:"passwordConfirm",deps:()=>({password:c(t).values.password}),rules:[{required:!0,pattern:/[a-zA-Z0-9]{8,20}/},{validator:(o,{password:u})=>u&&o!==u?"The passwordConfirm must same as password":""}]},{default:C(({field:o})=>{var u;return[d("input",k({class:"vfm-input",type:"password"},o),null,16),d("div",Ot,w((u=c(e).fieldError("passwordConfirm"))==null?void 0:u.message),1)]}),_:1},8,["form","deps","rules"])])]),E(nt),d("div",Zt,[Gt,d("div",Ht,[E(c(Ge),{form:c(e),name:"tags"},{default:C(({append:o,remove:u,fields:h})=>[d("div",Jt,[(A(!0),S(N,null,ae(h,(f,_)=>{var g;return A(),S("div",{class:"vfm-flex-item",key:f.id},[d("div",Qt,[d("div",Xt,[E(c(P),{form:c(e),name:`tags.${_}`,rules:[{required:!0,message:"Required"}]},{default:C(({field:$})=>[d("input",k({class:"vfm-input",type:"text"},$),null,16)]),_:2},1032,["form","name"])]),d("div",{class:"vfm-action red",onClick:$=>u(f.id)},"-",8,Yt)]),d("div",es,w((g=c(e).fieldError(`tags.${_}`))==null?void 0:g.message),1)])}),128))]),d("div",{class:"vfm-action",onClick:f=>o("")},"+",8,ts)]),_:1},8,["form"])])]),d("div",ss,[E(c(Ze),{form:c(e),name:"tags",value:()=>(c(e).state.values.tags.length,c(e).state.values.tags),rules:[{requiredLength:!0,message:"must have one tag"}]},null,8,["form","value"]),is,d("div",as,w((n=c(e).virtualFieldError("tags"))==null?void 0:n.message),1)]),E(Vt),E(Dt),d("div",ls,[d("button",{class:"vfm-button",onClick:i},"Submit"),c(e).state.isError?(A(),S("div",rs," Have error, cannot submit ")):H("",!0)])])]}),_:1},8,["form"]))}}),us=j(ns,[["__file","BaseForm.vue"]]);export{us as default};
